<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java 环境搭建 | 鸵鸟蛋的个人主页</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/image/logo.jpg">
    <meta name="description" content="鸵鸟蛋的世界">
    <link rel="preload" href="/assets/css/0.styles.22095322.css" as="style"><link rel="preload" href="/assets/js/app.83f3402d.js" as="script"><link rel="preload" href="/assets/js/2.a0a69aa9.js" as="script"><link rel="preload" href="/assets/js/5.247f2124.js" as="script"><link rel="prefetch" href="/assets/js/10.439f342d.js"><link rel="prefetch" href="/assets/js/11.216a07f2.js"><link rel="prefetch" href="/assets/js/12.a66aca6c.js"><link rel="prefetch" href="/assets/js/13.f5f24ce3.js"><link rel="prefetch" href="/assets/js/14.32d895c9.js"><link rel="prefetch" href="/assets/js/15.623a8373.js"><link rel="prefetch" href="/assets/js/16.31912b5c.js"><link rel="prefetch" href="/assets/js/17.68031807.js"><link rel="prefetch" href="/assets/js/18.a66b9dd4.js"><link rel="prefetch" href="/assets/js/19.c3c1ad4e.js"><link rel="prefetch" href="/assets/js/20.67c9540c.js"><link rel="prefetch" href="/assets/js/21.722fe9fe.js"><link rel="prefetch" href="/assets/js/22.72f8f629.js"><link rel="prefetch" href="/assets/js/23.f730e8f1.js"><link rel="prefetch" href="/assets/js/24.9e67058b.js"><link rel="prefetch" href="/assets/js/25.81a3aeea.js"><link rel="prefetch" href="/assets/js/26.18ba7257.js"><link rel="prefetch" href="/assets/js/27.eee6c364.js"><link rel="prefetch" href="/assets/js/28.d2732972.js"><link rel="prefetch" href="/assets/js/29.d54fb216.js"><link rel="prefetch" href="/assets/js/3.8959ecef.js"><link rel="prefetch" href="/assets/js/30.e71f561f.js"><link rel="prefetch" href="/assets/js/31.4f56f5c3.js"><link rel="prefetch" href="/assets/js/32.4ecd4417.js"><link rel="prefetch" href="/assets/js/33.32d721bd.js"><link rel="prefetch" href="/assets/js/34.ab789bed.js"><link rel="prefetch" href="/assets/js/35.e2330e74.js"><link rel="prefetch" href="/assets/js/36.a4d7a3e2.js"><link rel="prefetch" href="/assets/js/37.ca9e6d12.js"><link rel="prefetch" href="/assets/js/38.8e7d9dae.js"><link rel="prefetch" href="/assets/js/39.818446de.js"><link rel="prefetch" href="/assets/js/4.bc08363f.js"><link rel="prefetch" href="/assets/js/40.6e5412c0.js"><link rel="prefetch" href="/assets/js/41.c046cc2c.js"><link rel="prefetch" href="/assets/js/42.3a98e5b0.js"><link rel="prefetch" href="/assets/js/43.c48084fd.js"><link rel="prefetch" href="/assets/js/44.9a68e6e8.js"><link rel="prefetch" href="/assets/js/45.607f9d7b.js"><link rel="prefetch" href="/assets/js/46.4fbd5727.js"><link rel="prefetch" href="/assets/js/47.ff6cd126.js"><link rel="prefetch" href="/assets/js/48.4e44b645.js"><link rel="prefetch" href="/assets/js/49.b3559737.js"><link rel="prefetch" href="/assets/js/50.4c05ad25.js"><link rel="prefetch" href="/assets/js/51.27325a7b.js"><link rel="prefetch" href="/assets/js/52.62b7f674.js"><link rel="prefetch" href="/assets/js/53.fe6c2e96.js"><link rel="prefetch" href="/assets/js/54.68c91b01.js"><link rel="prefetch" href="/assets/js/55.a4e116a4.js"><link rel="prefetch" href="/assets/js/56.adec72d4.js"><link rel="prefetch" href="/assets/js/57.c8755c55.js"><link rel="prefetch" href="/assets/js/58.99e5de2f.js"><link rel="prefetch" href="/assets/js/59.f7deea0d.js"><link rel="prefetch" href="/assets/js/6.9cd44cad.js"><link rel="prefetch" href="/assets/js/60.608e9336.js"><link rel="prefetch" href="/assets/js/7.d1cbdc31.js"><link rel="prefetch" href="/assets/js/8.3e9a3d41.js"><link rel="prefetch" href="/assets/js/9.698ca62a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.22095322.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">鸵鸟蛋的个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://starcoderln.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/StarCoderLn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://starcoderln.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/StarCoderLn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VuePress</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>函数式编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面向切面编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/engineering/cli.html" class="sidebar-link">开发脚手架</a></li><li><a href="/engineering/buildtool.html" class="sidebar-link">Webpack 与 Gulp</a></li><li><a href="/engineering/cicd.html" class="sidebar-link">CI/CD</a></li><li><a href="/engineering/sonar.html" class="active sidebar-link">Java 环境搭建和 SonarQube 安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/sonar.html#java-环境搭建" class="sidebar-link">Java 环境搭建</a></li><li class="sidebar-sub-header"><a href="/engineering/sonar.html#sonarqube-安装与启动" class="sidebar-link">SonarQube 安装与启动</a></li></ul></li><li><a href="/engineering/jenkins.html" class="sidebar-link">Jenkins 安装</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端监控</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法学习总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac 开发体验优化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="java-环境搭建"><a href="#java-环境搭建" class="header-anchor">#</a> Java 环境搭建</h2> <ol><li><p>Java 环境的搭建需要下载安装 jdk。记住：一定要从 <a href="https://www.oracle.com/index.html" target="_blank" rel="noopener noreferrer">oracle 官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 下载最新的版本 <a href="https://www.oracle.com/java/technologies/javase-jdk14-downloads.html" target="_blank" rel="noopener noreferrer">jdk 下载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，不要通过其他渠道下载，因为后面的 SonarQube 对 Java 版本是有要求的。我的电脑是 mac，所以就下载 .dmg 格式的安装包。下载完成后直接傻瓜式进行安装就行了。</p></li> <li><p>安装完成后，我们可以通过 java -version 命令来查看是否安装成功。</p></li></ol> <p><img src="/assets/img/sonar1.1b57e3d7.png" alt="sonar" title="sonar"></p> <h2 id="sonarqube-安装与启动"><a href="#sonarqube-安装与启动" class="header-anchor">#</a> SonarQube 安装与启动</h2> <p><a href="https://www.sonarqube.org/" target="_blank" rel="noopener noreferrer">SonarQube<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一款代码质量和安全检测工具。它的安装与启动就比较麻烦，会遇到不少坑。下面就记录我遇到的一些坑。</p> <ol><li>首先需要从 SonarQube 官网上下载 .zip 格式的安装包。下载完成后，可以在终端通过以下命令进行解压。</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">unzip</span> sonarqube-8.4.0.35506.zip
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>解压完成后，将解压后的文件夹放到 opt 目录下，可以通过以下命令移动。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 在 root 用户下</span>
<span class="token function">mv</span> sonarqube-8.4.0.35506 /opt

<span class="token comment"># 在普通用户下</span>
<span class="token function">sudo</span> <span class="token function">mv</span> sonarqube-8.4.0.35506 /opt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>进入到 sonarqube-8.4.0.35506 目录中，可以看到有以下文件。</li></ol> <p><img src="/assets/img/sonar2.48620f6c.png" alt="sonar" title="sonar"></p> <p>再进入到 bin 目录中，这里面存放的就是一些存放启动脚本的目录，分别有 Linux、macOS 和 Windows 三种系统的，我的电脑是 macOS 系统，所以我选择 macosx-universal-64 目录。</p> <p><img src="/assets/img/sonar3.61435e61.png" alt="sonar" title="sonar"></p> <p>最后再进入 macosx-universal-64 目录中，里面有以下三个文件。其中 sonar.sh 就是我们启动需要用到的启动脚本。</p> <p><img src="/assets/img/sonar4.011dc742.png" alt="sonar" title="sonar"></p> <ol start="3"><li>我们可以通过执行 ./sonar.sh 命令来查看都有哪些帮助命令。</li></ol> <p><img src="/assets/img/sonar5.5cc2131a.png" alt="sonar" title="sonar"></p> <p>看起来 start 就是我们需要的启动命令，但是，注意这里不要用 start 命令去启动，因为用这个命令启动了之后并不能知道 SonarQube 启动成功了没。我们应该使用 console 命令来启动，因为它会打印出日志信息，出错了我们也好排查错误。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./sonar.sh console
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="4"><li>启动过程中碰到的问题。</li></ol> <ul><li>第一个问题是这样的：</li></ul> <p><img src="/assets/img/sonar6.e2f2f10b.png" alt="sonar" title="sonar"></p> <p>看到这个的时候一脸懵逼，看起来没输出什么错误啊，但是怎么跑不起来呢。肯定有某些地方出了问题，排查错误的一般方法如下：</p> <p>（1）首先，先看下打印的日志中有没有错误信息；</p> <p>（2）其次，再看看 macosx-universal-64 目录下生成的 wrapper.log 文件的内容，看看是不是打包器的问题。如果没有这个文件或者是文件内容为空，说明不是它的问题；</p> <p>（3）最后，可以看下 sonarqube-8.4.0.35506 目录下的 logs 目录，里面有两个错误日志文件，先看 sonar.log，如果没找到问题，再看 es.log。</p> <p><img src="/assets/img/sonar7.69c9d30b.png" alt="sonar" title="sonar"></p> <p>最终在 es.log 文件中找到了出错的原因：</p> <p><img src="/assets/img/sonar8.ccdb7838.png" alt="sonar" title="sonar"></p> <p>细看不难发现：不能以 root 身份启动。既然不能以 root 身份启动，那我们需要以什么身份启动呢？</p> <p>进入到 sonarqube-8.4.0.35506 目录下，然后查看目录里边所有文件的详细信息。里面的文件的所属用户是谁，我们就得用那个用户身份启动。而所属用户是你在解压的时候确定的，以哪个用户身份进行解压，所属用户就是哪个用户身份。</p> <p><img src="/assets/img/sonar9.84f6ceaa.png" alt="sonar" title="sonar"></p> <p>于是，我切换到 linnan 这个用户身份后，重新启动。却出现了第二个问题。</p> <ul><li>第二个问题是这样的：</li></ul> <p><img src="/assets/img/sonar10.8203018a.png" alt="sonar" title="sonar"></p> <p>可以发现这是文件的权限问题。解决方法就是修改下文件权限：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 在 root 用户下</span>
<span class="token function">chmod</span> <span class="token number">777</span> /opt/sonarqube-8.4.0.35506/temp/sharedmemory

<span class="token comment"># 在普通用户下</span>
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /opt/sonarqube-8.4.0.35506/temp/sharedmemory
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然后又出现了第三个问题。</p> <ul><li>第三个问题是这样的：</li></ul> <p><img src="/assets/img/sonar11.e0a4524e.png" alt="sonar" title="sonar"></p> <p>这是因为 /opt/sonarqube-8.4.0.35506/temp/conf/es/elasticsearch.yml 这个文件的所属用户并不是 linnan，而是 root。</p> <p><img src="/assets/img/sonar12.8000e074.png" alt="sonar" title="sonar"></p> <p>所以需要改下这个文件的所属用户，修改命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 在 root 用户下</span>
<span class="token function">chown</span> linnan /opt/sonarqube-8.4.0.35506/temp/conf/es/elasticsearch.yml

<span class="token comment"># 在普通用户下</span>
<span class="token function">sudo</span> <span class="token function">chown</span> linnan /opt/sonarqube-8.4.0.35506/temp/conf/es/elasticsearch.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>改好之后重新启动，还会遇到其他的文件也有上面第二、第三种类型的问题，一一解决就好了。</p> <p>解决完所有问题之后终于启动成功了！</p> <p><img src="/assets/img/sonar13.b9387dd7.png" alt="sonar" title="sonar"></p> <p>在浏览器中访问 localhost:9000 就可以看到启动界面：</p> <p><img src="/assets/img/sonar14.0195950a.png" alt="sonar" title="sonar"></p> <p>可以点击右上角进行登录，默认的用户名和密码都是 admin。</p> <p><strong>5. 使用 SonarQube</strong></p> <p>（1）登录完成后，我们需要先安装一个中文插件 Chinese Pack，安装完成后需要重启服务器，就可以看到界面是中文的了。</p> <p><img src="/assets/img/sonar15.a8aa487e.png" alt="sonar" title="sonar"></p> <p><img src="/assets/img/sonar16.f98148af.png" alt="sonar" title="sonar"></p> <p>（2）接着创建一个新项目。</p> <ul><li>设置项目名称。</li></ul> <p><img src="/assets/img/sonar17.10323248.png" alt="sonar" title="sonar"></p> <ul><li><p>创建一个令牌（token），给客户端使用。</p> <p><strong>我创建的令牌是：tuoniaodan_token:8d6a0260d4dda3009a652ac176062ef5ef11bfd1。</strong></p></li></ul> <p><img src="/assets/img/sonar18.5958df9e.png" alt="sonar" title="sonar"></p> <p><img src="/assets/img/sonar19.72b25ec8.png" alt="sonar" title="sonar"></p> <ul><li>配置项目。</li></ul> <p><img src="/assets/img/sonar20.dc644b08.png" alt="sonar" title="sonar"></p> <p>点击图里的下载按钮可以下载扫描器（SonarScanner）。</p> <p>到此，服务端的配置就完成了。</p> <p><strong>6. SonarScanner 的安装与使用</strong></p> <p><a href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/" target="_blank" rel="noopener noreferrer">SonarScanner<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个命令行工具。</p> <p>（1）首先下载 SonarScanner 的安装包，然后解压。可以使用 unzip 命令解压，也可以直接右键解压。</p> <p>（2）配置环境变量。</p> <p>🔔 <strong>这里要注意，对于 mac 默认的终端 bash，配置环境变量的文件是 .bash_profile，但是，我使用的终端是 zsh，它的环境变量配置文件是 .zshrc</strong>。</p> <ul><li>首先进入到 .zshrc 文件中</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vi</span> .zshrc

<span class="token comment"># 或者</span>

<span class="token function">open</span> -e .zshrc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>然后在 .zshrc 文件中加上以下变量。SONAR_SCANNER_HOME 是一个变量名，名字可以随意命名。它的值就是 SonarScanner 解压后安装包的位置。因为我们需要把 SonarScanner 的 bin 目录配置到环境变量中。</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">SONAR_SCANNER_HOME</span><span class="token operator">=</span>/Users/linnan/Desktop/projects/sonar-scanner-4.4.0.2170-macosx
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$SONAR_SCANNER_HOME</span>/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/sonar21.fd6540a8.png" alt="sonar" title="sonar"></p> <ul><li>配置好之后，还需要执行命令 <code>source .zshrc</code> 来使环境变量生效。最后在终端执行 <code>snoar-scanner -h</code> 命令，如果看到以下信息就说明安装成功了。</li></ul> <p><img src="/assets/img/sonar22.e57235c7.png" alt="sonar" title="sonar"></p> <p>（3）安装好 SonarScanner 之后，我们就可以配合 SonarQube 来扫描项目了。首先我们需要在本机上有一个项目，然后在这个项目的根目录下创建一个 <code>sonar-project.properties</code> 文件，并在文件中添加以下命令。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># must be unique in a given SonarQube instance</span>
sonar.projectKey<span class="token operator">=</span>my:project

<span class="token comment"># --- optional properties ---</span>

<span class="token comment"># defaults to project key</span>
sonar.projectName<span class="token operator">=</span>sell
<span class="token comment"># defaults to 'not provided'</span>
<span class="token comment">#sonar.projectVersion=1.0</span>
 
<span class="token comment"># Path is relative to the sonar-project.properties file. Defaults to .</span>
sonar.sources<span class="token operator">=</span>src
 
<span class="token comment"># Encoding of the source code. Default is default system encoding</span>
<span class="token comment">#sonar.sourceEncoding=UTF-8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>其中 sonar.projectKey 是一个唯一的标识，随便给个值就行，sonar.projectName 就是你的项目名称，sonar.sources 是项目中源代码所在的目录。</p> <p>（4）配置好以上步骤之后，启动 SonarQube。在项目里执行以下命令，就会自动扫描我们的项目。扫描完成后就会生成关于项目的一些报表。在 SonarQube 的项目页面里可以看到。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>sonar-scanner
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/sonar23.8e7bf089.png" alt="sonar" title="sonar"></p> <p><img src="/assets/img/sonar24.96d8a2af.png" alt="sonar" title="sonar"></p> <p>（5）如果想知道扫描器是以什么规则去扫描代码的，可以在代码规则页面里查看。我们的项目是用什么语言，就在点击左侧对应的语言查看相关的规则。规则也可以自己根据公司的规范进行设定。而且点击每条规则之后还会有详细说明，这个说明文档也可以供我们学习。</p> <p><strong>7. SonarQube 的价值所在</strong></p> <ul><li>SonarQube 看起来好像跟 ESlint 的功能差不多，只不过是多了个服务器。<strong>但是，SonarQube 真正值钱的地方在于它的处理流程，这个系统能够接入到 Jenkins，并且扫描出问题之后还能接入到缺陷管理相关的系统里，比如：Jira。它是代码质量管理流程中很重要的一个环节</strong>。</li></ul> <p><strong>8. SonarQube 的处理流程</strong></p> <ul><li><p>SonarQube 的架构值得我们学习，它有一个服务器 server，然后在本机上有一个扫描器 scanner。处理流程是这样的：</p></li> <li><p>首先 scanner 通过 token 登录到 server 上，然后把代码规则拉下来，之后 scanner 再去扫描项目代码，扫描检查完项目代码之后，先在本机上生成一份检查报告，再把这份报告上传到服务器上。因此，要记住一点，扫描器 scanner 不能离开服务器 server。</p></li></ul> <p><strong>9. SonarQube 配置数据库</strong></p> <ul><li><p>SonarQube 下载下来之后，需要配置数据库。不过，不配置也没关系，但是自带的数据库性能不高，用于学习和处理一些小项目是没问题的，但是处理大项目时可能就撑不住了。数据库在 sonar.properties 文件中配置，这个文件位于 sonarqube-8.4.0.35506 目录下的 conf 目录里。需要配置的是下面这些：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 数据库名称</span>
sonar.jdbc.username<span class="token operator">=</span><span class="token punctuation">..</span>.
<span class="token comment"># 数据库密码</span>
sonar.jdbc.password<span class="token operator">=</span><span class="token punctuation">..</span>.
<span class="token comment"># 数据库连接串</span>
sonar.jdbc.url<span class="token operator">=</span><span class="token punctuation">..</span>. 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>还要注意，官方的 SonarQube 不支持 MySQL 数据库，默认支持的数据库是 PostgreSQL，这是一个开源的数据库。此外，还支持 ms SQL（微软的 SQLServer 数据库服务器）和 Qracle。如果想用 MySQL 的话，还得去下载 <a href="https://dev.mysql.com/downloads/" target="_blank" rel="noopener noreferrer">MySQL Connector/J<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/engineering/cicd.html" class="prev">
        CI/CD
      </a></span> <span class="next"><a href="/engineering/jenkins.html">
        Jenkins 安装
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.83f3402d.js" defer></script><script src="/assets/js/2.a0a69aa9.js" defer></script><script src="/assets/js/5.247f2124.js" defer></script>
  </body>
</html>
