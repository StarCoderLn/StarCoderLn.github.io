(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{475:function(t,v,_){t.exports=_.p+"assets/img/https.56a68ab4.png"},476:function(t,v,_){t.exports=_.p+"assets/img/http2-1.1f7924d8.png"},477:function(t,v,_){t.exports=_.p+"assets/img/http2-2.cf8c553c.png"},478:function(t,v,_){t.exports=_.p+"assets/img/http2-3.fb094dc8.png"},479:function(t,v,_){t.exports=_.p+"assets/img/http2-4.ab85d327.png"},480:function(t,v,_){t.exports=_.p+"assets/img/http2-5.66b10c92.png"},481:function(t,v,_){t.exports=_.p+"assets/img/http2-6.b8118cad.png"},482:function(t,v,_){t.exports=_.p+"assets/img/http3-1.bba27651.png"},483:function(t,v,_){t.exports=_.p+"assets/img/http3-2.f90bc6e3.png"},745:function(t,v,_){"use strict";_.r(v);var p=_(33),i=Object(p.a)({},(function(){var t=this,v=t.$createElement,p=t._self._c||v;return p("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[p("h2",{attrs:{id:"ssl-tls-协议"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#ssl-tls-协议"}},[t._v("#")]),t._v(" SSL/TLS 协议")]),t._v(" "),p("ol",[p("li",[p("p",[p("strong",[t._v("传输层安全性协议")]),t._v("("),p("strong",[t._v("Transport Layer Security，TLS")]),t._v(")，及其前身"),p("strong",[t._v("安全套接层")]),t._v("("),p("strong",[t._v("Secure Sockets Layer，SSL")]),t._v(")是一种安全协议，目的是为互联网通信提供安全及数据完整性保障。")])]),t._v(" "),p("li",[p("p",[t._v("HTTPS 协议的安全性由 SSL 协议实现，当前使用的 TLS 协议1.2版本包含了四个核心子协议："),p("strong",[t._v("握手协议")]),t._v("、"),p("strong",[t._v("密钥配置切换协议")]),t._v("、"),p("strong",[t._v("应用数据协议")]),t._v("及"),p("strong",[t._v("报警协议")]),t._v("。")])]),t._v(" "),p("li",[p("p",[t._v("在七层结构中，SSL/TLS 协议位于"),p("strong",[t._v("会话层")]),t._v("，而在四层结构中，SSL/TLS 协议位于"),p("strong",[t._v("应用层和传输层之间，是跨层的")]),t._v("。")])]),t._v(" "),p("li",[p("p",[t._v("TLS 适用于对称密钥，对称密钥可以通过安全密钥交换算法共享。如果请求被截获，密钥交换可能会被欺骗，TLS 使用数字签名进行身份验证，证书颁发机构和信任链。")])]),t._v(" "),p("li",[p("p",[t._v("HTTPS 协议、SSL 协议、TLS 协议、握手协议的关系")])])]),t._v(" "),p("ul",[p("li",[p("p",[t._v("HTTPS 是 Hypertext Transfer Protocol over Secure Socket Layer 的缩写，即 HTTP over SSL，可理解为"),p("strong",[t._v("基于 SSL 的 HTTP 协议")]),t._v("。"),p("strong",[t._v("HTTPS 协议安全是由 SSL 协议实现的")]),t._v("。")])]),t._v(" "),p("li",[p("p",[t._v("SSL 协议是一种"),p("strong",[t._v("记录协议")]),t._v("，扩展性良好，可以很方便的添加子协议。")])]),t._v(" "),p("li",[p("p",[t._v("握手协议是 SSL 协议的一个子协议。")])]),t._v(" "),p("li",[p("p",[t._v("TLS 协议是 SSL 协议的后续版本，当前涉及的 SSL 协议默认是 TLS 协议1.2版本。")])])]),t._v(" "),p("h2",{attrs:{id:"https-协议分析"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#https-协议分析"}},[t._v("#")]),t._v(" HTTPS 协议分析")]),t._v(" "),p("p",[t._v("TLS 握手的步骤：")]),t._v(" "),p("ol",[p("li",[p("p",[t._v("ClientHello：客户端发送所支持的 SSL/TLS 最高协议版本号和所支持的加密算法集合及压缩方法集合等信息给服务器端。")])]),t._v(" "),p("li",[p("p",[t._v("ServerHello：服务器端收到客户端信息后，"),p("strong",[t._v("选定")]),t._v("双方都能够支持的 SSL/TLS 协议版本和加密方法及压缩方法，返回给客户端。")])]),t._v(" "),p("li",[p("p",[t._v("SendCertificate(可选)：服务器端发送服务端证书给客户端。")])]),t._v(" "),p("li",[p("p",[t._v("RequestCertificate(可选)：如果选择双向验证，服务器端向客户端请求客户端证书。")])]),t._v(" "),p("li",[p("p",[t._v("ServerHelloDone：服务器端通知客户端初始协商结束。")])]),t._v(" "),p("li",[p("p",[t._v("ResponseCertificate(可选)：如果选择双向验证，客户端向服务器端发送客户端证书。")])]),t._v(" "),p("li",[p("p",[t._v("ClientKeyExchange：客户端使用服务器端的公钥，对客户端公钥和密钥种子进行加密，再发送给服务器端。")])]),t._v(" "),p("li",[p("p",[t._v("CertificateVerify(可选)：如果选择双向验证，客户端用本地私钥生成数字签名，并发送给服务器端，让其通过收到的客户端公钥进行身份验证。")])]),t._v(" "),p("li",[p("p",[t._v("CreateSecretKey：通讯双方基于密钥种子等信息生成通讯密钥。")])]),t._v(" "),p("li",[p("p",[t._v("ChangeCipherSpec：客户端通知服务器端已将通讯方式切换到加密模式。")])]),t._v(" "),p("li",[p("p",[t._v("Finished：客户端做好加密通讯的准备。")])]),t._v(" "),p("li",[p("p",[t._v("ChangeCipherSpec：服务器端通知客户端已将通讯方式切换到加密模式。")])]),t._v(" "),p("li",[p("p",[t._v("Finished：服务器做好加密通讯的准备。")])]),t._v(" "),p("li",[p("p",[t._v("Encrypted/DecryptedData：双方使用客户端密钥，通过对称加密算法对通讯内容进行加密。")])]),t._v(" "),p("li",[p("p",[t._v("ClosedConnection：通讯结束后，任何一方发出断开 SSL 连接的消息。")])])]),t._v(" "),p("p",[p("img",{attrs:{src:_(475),alt:"https",title:"https"}})]),t._v(" "),p("div",{staticClass:"custom-block tip"},[p("p",{staticClass:"custom-block-title"},[t._v("两个需要留意的问题")]),t._v(" "),p("ol",[p("li",[p("p",[t._v("必须先建立 TCP 连接，服务器才能传证书，在建立 TCP 连接之前，服务器得知道 IP 地址，那么就得先进行 DNS 解析。因此，证书是在 DNS 解析和 TCP 连接建立完成之后获得的。")])]),t._v(" "),p("li",[p("p",[t._v("TCP 3次握手先于 HTTPS 握手。")])])])]),t._v(" "),p("h2",{attrs:{id:"http2-协议分析"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#http2-协议分析"}},[t._v("#")]),t._v(" HTTP2 协议分析")]),t._v(" "),p("ol",[p("li",[p("p",[t._v("HTTP/2.0 没有改动 HTTP 的应用语义。HTTP 方法、状态代码、URI 和标 头字段等核心概念一如往常。")])]),t._v(" "),p("li",[p("p",[t._v("HTTP/2.0 修改了"),p("strong",[t._v("数据格式化(分帧)"),p("strong",[t._v("以及")]),t._v("在客户端与服务器间传输的方式")]),t._v("。这两点统帅全局，通过新的分帧层向我们的应用隐藏了所有复杂性。")])]),t._v(" "),p("li",[p("p",[t._v("由于 HTTP/2.0 引入了一个"),p("strong",[t._v("新的二进制分帧层")]),t._v("，该层无法与之前的 HTTP/1.x 服务器和客户端向后兼容，因此协议的主版本提升到 HTTP/2.0。")])]),t._v(" "),p("li",[p("p",[t._v("HTTP/2.0 的特点")])])]),t._v(" "),p("ul",[p("li",[p("p",[t._v("使用二进制格式传输，更高效、更紧凑。")])]),t._v(" "),p("li",[p("p",[t._v("对报头压缩，降低开销。")])]),t._v(" "),p("li",[p("p",[t._v("多路复用，一个网络连接实现并行请求。")])]),t._v(" "),p("li",[p("p",[t._v("服务器主动推送，减少请求的延迟。")])]),t._v(" "),p("li",[p("p",[t._v("默认使用加密。")])])]),t._v(" "),p("ol",{attrs:{start:"5"}},[p("li",[t._v("HTTP/2.0 二进制分帧层")])]),t._v(" "),p("ul",[p("li",[p("p",[t._v("HTTP/2.0 所有性能增强的核心在于新的二进制分帧层，它定义了如何封装 HTTP 消息并在客户端与服务器之间传输。")])]),t._v(" "),p("li",[p("p",[t._v("这里所谓的“层”指的是位于套接字接口与应用可见的高级 HTTP API 之间一个经过优化的新编码机制。")])]),t._v(" "),p("li",[p("p",[t._v("HTTP/1.x 协议以换行符作为纯文本的分隔符，而 HTTP/2.0 将所有传输的信息分割为更小的消息和帧，并采用二进制格式对它们编码。")])]),t._v(" "),p("li",[p("p",[t._v("客户端和服务器会替我们完成必要的分帧工作。")])])]),t._v(" "),p("p",[p("img",{attrs:{src:_(476),alt:"http2",title:"http2"}})]),t._v(" "),p("ol",{attrs:{start:"6"}},[p("li",[t._v("HTTP/2.0 多路复用")])]),t._v(" "),p("ul",[p("li",[p("p",[t._v("在 HTTP/1.x 中，如果客户端要想发起多个并行请求以提升性能，则必须使用多个 TCP 连接。这种模型也会导致队首阻塞，从而造成底层 TCP 连接的效率低下。")])]),t._v(" "),p("li",[p("p",[p("strong",[t._v("将 HTTP 消息分解为独立的帧，交错发送，然后在另一端重新组装")]),t._v("是 HTTP/2.0 最重要的一项增强。这个机制会在整个网络技术栈中引发一系列连锁反应，从而带来巨大的性能提升。")])])]),t._v(" "),p("p",[t._v("（1）并行交错地发送多个请求，请求之间互不影响。")]),t._v(" "),p("p",[t._v("（2）并行交错地发送多个响应，响应之间互不干扰。")]),t._v(" "),p("p",[t._v("（3）使用一个连接并行发送多个请求和响应。")]),t._v(" "),p("p",[t._v("（4）不必再为绕过 HTTP/1.x 限制而做很多工作。")]),t._v(" "),p("p",[t._v("（5）消除不必要的延迟和提高现有网络容量的利用率，从而减少页面加载时间。")]),t._v(" "),p("p",[p("img",{attrs:{src:_(477),alt:"http2",title:"http2"}})]),t._v(" "),p("p",[p("img",{attrs:{src:_(478),alt:"http2",title:"http2"}})]),t._v(" "),p("blockquote",[p("p",[t._v("服务器是属于 IO 密集型的，所以它的压力主要在于 I/O 开销。HTTP 连接越多，服务器的压力越大。")])]),t._v(" "),p("h2",{attrs:{id:"http2-服务器推送"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#http2-服务器推送"}},[t._v("#")]),t._v(" HTTP2 服务器推送")]),t._v(" "),p("ol",[p("li",[p("p",[t._v("HTTP/2.0 新增的另一个强大的新功能是，"),p("strong",[t._v("服务器可以对一个客户端请求发送多个响应")]),t._v("。 换句话说，"),p("strong",[t._v("除了对最初请求的响应外，服务器还可以向客户端推送额外资源，而无需客户端明确地请求")]),t._v("。")])]),t._v(" "),p("li",[p("p",[t._v("HTTP/2.0 打破了严格的请求-响应语义，支持"),p("strong",[t._v("一对多")]),t._v("和服务器发起的推送工作流。")])]),t._v(" "),p("li",[p("p",[t._v("服务器已经知道客户端下一步要请求什么资源，这时候服务器推送即可派上用场。")])]),t._v(" "),p("li",[p("p",[t._v("推送资源可以进行以下处理.")])])]),t._v(" "),p("ul",[p("li",[p("p",[t._v("由客户端缓存。")])]),t._v(" "),p("li",[p("p",[t._v("在不同页面之间重用（只要多个页面在同一个域下，websocket 就做不到这点，它只能在当前页面复用）。")])]),t._v(" "),p("li",[p("p",[t._v("与其他资源一起复用。")])]),t._v(" "),p("li",[p("p",[t._v("由服务器设定优先级。")])]),t._v(" "),p("li",[p("p",[t._v("被客户端拒绝。")])])]),t._v(" "),p("p",[p("img",{attrs:{src:_(479),alt:"http2",title:"http2"}})]),t._v(" "),p("h2",{attrs:{id:"http2-伪头字段"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#http2-伪头字段"}},[t._v("#")]),t._v(" HTTP2 伪头字段")]),t._v(" "),p("ol",[p("li",[t._v("伪头部字段是 HTTP/2.0 内置的几个特殊的以”:”开始的 key，用于替代 HTTP/1.x 中请求行/响应行中的信息，比如请求方法，响应状态码等。")])]),t._v(" "),p("ul",[p("li",[p("p",[t._v(":method 目标 URL 模式部分(请求)")])]),t._v(" "),p("li",[p("p",[t._v(":scheme 目标 URL 模式部分(请求)")])]),t._v(" "),p("li",[p("p",[t._v(":authority 目标 URL 认证部分(请求)")])]),t._v(" "),p("li",[p("p",[t._v(':path 目标URL的路径和查询部分(绝对路径产生式和一个跟着"?"字符的查询产生式)。(请求)')])]),t._v(" "),p("li",[p("p",[t._v(":status 响应头中的HTTP状态码部分(响应)")])])]),t._v(" "),p("p",[p("img",{attrs:{src:_(480),alt:"http2",title:"http2"}})]),t._v(" "),p("p",[t._v("比如，"),p("a",{attrs:{href:"https://ke.qq.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("腾讯课堂"),p("OutboundLink")],1),t._v("用的就是 HTTP2。")]),t._v(" "),p("p",[p("img",{attrs:{src:_(481),alt:"http2",title:"http2"}})]),t._v(" "),p("blockquote",[p("p",[t._v("要想使用 HTTP2，得用专门的服务器。")])]),t._v(" "),p("h2",{attrs:{id:"了解-http3"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#了解-http3"}},[t._v("#")]),t._v(" 了解 HTTP3")]),t._v(" "),p("ol",[p("li",[p("p",[t._v("运行在 "),p("a",{attrs:{href:"https://www.chromium.org/quic",target:"_blank",rel:"noopener noreferrer"}},[t._v("QUIC"),p("OutboundLink")],1),t._v(" 之上的 HTTP 协议被称为 HTTP/3.0(HTTP-over-QUIC)。")])]),t._v(" "),p("li",[p("p",[t._v("QUIC 协议(Quick UDP Internet Connection)"),p("strong",[t._v("基于 UDP")]),t._v("，正是看中了 UDP 的速度与效率。同时 QUIC 也整合了 TCP、TLS 和 HTTP/2 的优点，并加以优化。")])]),t._v(" "),p("li",[p("p",[t._v("特点")])])]),t._v(" "),p("ul",[p("li",[p("p",[t._v("减少了握手的延迟(1-RTT 或 0-RTT)。")])]),t._v(" "),p("li",[p("p",[t._v("多路复用，并且没有 TCP 的阻塞问题。")])]),t._v(" "),p("li",[p("p",[t._v("连接迁移，(主要是在客户端)当由 Wifi 转移到 4G 时，连接不会被断开。")])])]),t._v(" "),p("ol",{attrs:{start:"4"}},[p("li",[p("p",[t._v("HTTP/3.0 与 HTTP/1.1 和 HTTP/2.0 没有直接的关系，也不是 HTTP/2.0 的扩展。")])]),t._v(" "),p("li",[p("p",[t._v("HTTP/3.0 将会是一个全新的 WEB 协议。")])]),t._v(" "),p("li",[p("p",[t._v("HTTP/3.0 目前处于制订和测试阶段。")])]),t._v(" "),p("li",[p("p",[t._v("HTTP/1.x 和 HTTP/2.0 发送和接收数据包的时候，是需要严格按照包序号的顺序来传输的，但是 HTTP/3.0 并不在乎包的序号，它只在乎接收到的包数量齐全了吗，缺少的包再让服务器重发。")])]),t._v(" "),p("li",[p("p",[t._v("HTTP/3.0 在移动网络上有非常大的优势。")])])]),t._v(" "),p("p",[p("img",{attrs:{src:_(482),alt:"http3",title:"http3"}})]),t._v(" "),p("div",{staticClass:"custom-block warning"},[p("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),p("p",[t._v("HTTP/2.0 会向前兼容 1.0 和 1.1，但是 HTTP/3.0 并不向前兼容，它是全新的。")])]),t._v(" "),p("h2",{attrs:{id:"队首阻塞问题"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#队首阻塞问题"}},[t._v("#")]),t._v(" 队首阻塞问题")]),t._v(" "),p("ol",[p("li",[p("p",[t._v("HTTP/1.1 和 HTTP/2.0 都存在队头阻塞问题(Head of line blocking)。")])]),t._v(" "),p("li",[p("p",[t._v("HTTP/1.1 的队头阻塞。一个 TCP 连接同时传输 10 个请求，其中第 1、2、3 个请求已被客户端接收，但第 4 个请求丢失，那么后面第 5 - 10 个请求都被阻塞，需要等第 4 个请求处理完毕才能被处理，这样就浪费了带宽资源。")])]),t._v(" "),p("li",[p("p",[t._v("HTTP/2.0 的多路复用虽然可以解决“请求”这个粒度的阻塞，但 HTTP/2.0 的基础 TCP 协议本身却也存在着队头阻塞的问题。")])]),t._v(" "),p("li",[p("p",[t._v("由于 HTTP/2.0 必须使用 HTTPS，而 HTTPS 使用的 TLS 协议也存在队头阻塞问题。")])]),t._v(" "),p("li",[p("p",[t._v("队头阻塞会导致 HTTP/2.0 在更容易丢包的弱网络环境下比 HTTP/1.1 更慢。")])]),t._v(" "),p("li",[p("p",[t._v("QUIC 解决队头阻塞问题的的方法如下：")])])]),t._v(" "),p("ul",[p("li",[p("p",[t._v("QUIC 的传输单元是 Packet，加密单元也是 Packet，整个加密、传输、解密都基于 Packet，这样就能避免 TLS 的队头阻塞问题;")])]),t._v(" "),p("li",[p("p",[t._v("QUIC 基于 UDP，UDP 的数据包在接收端没有处理顺序，即使中间丢失一个包，也不会阻塞整条连接，其他的资源会被正常处理。")])])]),t._v(" "),p("p",[p("img",{attrs:{src:_(483),alt:"http3",title:"http3"}})])])}),[],!1,null,null,null);v.default=i.exports}}]);