<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ğŸ“š æµè§ˆå™¨ä¸­çš„ event loop | é¸µé¸Ÿè›‹çš„ä¸ªäººä¸»é¡µ</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/image/logo.jpg">
    <meta name="description" content="é¸µé¸Ÿè›‹çš„ä¸–ç•Œ">
    <link rel="preload" href="/assets/css/0.styles.22095322.css" as="style"><link rel="preload" href="/assets/js/app.83f3402d.js" as="script"><link rel="preload" href="/assets/js/2.a0a69aa9.js" as="script"><link rel="preload" href="/assets/js/14.32d895c9.js" as="script"><link rel="prefetch" href="/assets/js/10.439f342d.js"><link rel="prefetch" href="/assets/js/11.216a07f2.js"><link rel="prefetch" href="/assets/js/12.a66aca6c.js"><link rel="prefetch" href="/assets/js/13.f5f24ce3.js"><link rel="prefetch" href="/assets/js/15.623a8373.js"><link rel="prefetch" href="/assets/js/16.31912b5c.js"><link rel="prefetch" href="/assets/js/17.68031807.js"><link rel="prefetch" href="/assets/js/18.a66b9dd4.js"><link rel="prefetch" href="/assets/js/19.c3c1ad4e.js"><link rel="prefetch" href="/assets/js/20.67c9540c.js"><link rel="prefetch" href="/assets/js/21.722fe9fe.js"><link rel="prefetch" href="/assets/js/22.72f8f629.js"><link rel="prefetch" href="/assets/js/23.f730e8f1.js"><link rel="prefetch" href="/assets/js/24.9e67058b.js"><link rel="prefetch" href="/assets/js/25.81a3aeea.js"><link rel="prefetch" href="/assets/js/26.18ba7257.js"><link rel="prefetch" href="/assets/js/27.eee6c364.js"><link rel="prefetch" href="/assets/js/28.d2732972.js"><link rel="prefetch" href="/assets/js/29.d54fb216.js"><link rel="prefetch" href="/assets/js/3.8959ecef.js"><link rel="prefetch" href="/assets/js/30.e71f561f.js"><link rel="prefetch" href="/assets/js/31.4f56f5c3.js"><link rel="prefetch" href="/assets/js/32.4ecd4417.js"><link rel="prefetch" href="/assets/js/33.32d721bd.js"><link rel="prefetch" href="/assets/js/34.ab789bed.js"><link rel="prefetch" href="/assets/js/35.e2330e74.js"><link rel="prefetch" href="/assets/js/36.a4d7a3e2.js"><link rel="prefetch" href="/assets/js/37.ca9e6d12.js"><link rel="prefetch" href="/assets/js/38.8e7d9dae.js"><link rel="prefetch" href="/assets/js/39.818446de.js"><link rel="prefetch" href="/assets/js/4.bc08363f.js"><link rel="prefetch" href="/assets/js/40.6e5412c0.js"><link rel="prefetch" href="/assets/js/41.c046cc2c.js"><link rel="prefetch" href="/assets/js/42.3a98e5b0.js"><link rel="prefetch" href="/assets/js/43.c48084fd.js"><link rel="prefetch" href="/assets/js/44.9a68e6e8.js"><link rel="prefetch" href="/assets/js/45.607f9d7b.js"><link rel="prefetch" href="/assets/js/46.4fbd5727.js"><link rel="prefetch" href="/assets/js/47.ff6cd126.js"><link rel="prefetch" href="/assets/js/48.4e44b645.js"><link rel="prefetch" href="/assets/js/49.b3559737.js"><link rel="prefetch" href="/assets/js/5.247f2124.js"><link rel="prefetch" href="/assets/js/50.4c05ad25.js"><link rel="prefetch" href="/assets/js/51.27325a7b.js"><link rel="prefetch" href="/assets/js/52.62b7f674.js"><link rel="prefetch" href="/assets/js/53.fe6c2e96.js"><link rel="prefetch" href="/assets/js/54.68c91b01.js"><link rel="prefetch" href="/assets/js/55.a4e116a4.js"><link rel="prefetch" href="/assets/js/56.adec72d4.js"><link rel="prefetch" href="/assets/js/57.c8755c55.js"><link rel="prefetch" href="/assets/js/58.99e5de2f.js"><link rel="prefetch" href="/assets/js/59.f7deea0d.js"><link rel="prefetch" href="/assets/js/6.9cd44cad.js"><link rel="prefetch" href="/assets/js/60.608e9336.js"><link rel="prefetch" href="/assets/js/7.d1cbdc31.js"><link rel="prefetch" href="/assets/js/8.3e9a3d41.js"><link rel="prefetch" href="/assets/js/9.698ca62a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.22095322.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">é¸µé¸Ÿè›‹çš„ä¸ªäººä¸»é¡µ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://starcoderln.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ä¸»é¡µ
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/StarCoderLn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://starcoderln.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ä¸»é¡µ
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/StarCoderLn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VuePress</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æœåŠ¡å™¨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‡½æ•°å¼ç¼–ç¨‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é¢å‘åˆ‡é¢ç¼–ç¨‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javascript/jsUnknow1.html" class="sidebar-link">ä½ ä¸çŸ¥é“çš„JavaScriptï¼ˆä¸Šï¼‰</a></li><li><a href="/javascript/ecmascript.html" class="sidebar-link">ECMAScript</a></li><li><a href="/javascript/promise.html" class="sidebar-link">æ‰‹å†™Promise</a></li><li><a href="/javascript/eventloop.html" class="active sidebar-link">Event loop æ€»ç»“</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#æµè§ˆå™¨ä¸­çš„-event-loop" class="sidebar-link">ğŸ“š æµè§ˆå™¨ä¸­çš„ event loop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#event-loop-ç¤ºæ„å›¾" class="sidebar-link">ğŸ“˜ event loop ç¤ºæ„å›¾</a></li><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#å¼‚æ­¥é˜Ÿåˆ—åˆ†ç±»" class="sidebar-link">ğŸ“˜ å¼‚æ­¥é˜Ÿåˆ—åˆ†ç±»</a></li><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#æµè§ˆå™¨ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—" class="sidebar-link">ğŸ“˜ æµè§ˆå™¨ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—</a></li><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#event-loop-ç»ƒä¹ é¢˜" class="sidebar-link">ğŸ“˜ event loop ç»ƒä¹ é¢˜</a></li></ul></li><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#node-js-ä¸­çš„-event-loop" class="sidebar-link">ğŸ“š Node.js ä¸­çš„ event loop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#æ•´ä½“æµç¨‹å›¾" class="sidebar-link">ğŸ“˜ æ•´ä½“æµç¨‹å›¾</a></li><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#å¼‚æ­¥æ‰§è¡Œé˜Ÿåˆ—é˜¶æ®µ" class="sidebar-link">ğŸ“˜ å¼‚æ­¥æ‰§è¡Œé˜Ÿåˆ—é˜¶æ®µ</a></li><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#node-js-ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—" class="sidebar-link">ğŸ“˜ Node.js ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—</a></li><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#node-js-ä¸­çš„ä»»åŠ¡æ¯”è¾ƒ" class="sidebar-link">ğŸ“˜ Node.js ä¸­çš„ä»»åŠ¡æ¯”è¾ƒ</a></li><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#ç»ƒä¹ é¢˜" class="sidebar-link">ğŸ“˜ ç»ƒä¹ é¢˜</a></li><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#ä¸åŒ-node-ç‰ˆæœ¬çš„-event-loop" class="sidebar-link">ğŸ“˜ ä¸åŒ Node ç‰ˆæœ¬çš„ event loop</a></li><li class="sidebar-sub-header"><a href="/javascript/eventloop.html#å…³äºä¸åŒç‰ˆæœ¬å˜åŒ–çš„å‡ ä¸ª-demo" class="sidebar-link">ğŸ“˜ å…³äºä¸åŒç‰ˆæœ¬å˜åŒ–çš„å‡ ä¸ª demo</a></li></ul></li></ul></li><li><a href="/javascript/jsUtils.html" class="sidebar-link">JavaScriptå¸¸ç”¨å·¥å…·æ–¹æ³•</a></li><li><a href="/javascript/qa.html" class="sidebar-link">JavaScriptä¸QAå·¥ç¨‹å¸ˆ</a></li><li><a href="/javascript/jsTest.html" class="sidebar-link">JavaScriptåŸºç¡€æµ‹è¯•</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯å·¥ç¨‹åŒ–</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æµè§ˆå™¨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ€§èƒ½ä¼˜åŒ–</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯ç›‘æ§</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç®—æ³•å­¦ä¹ æ€»ç»“</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac å¼€å‘ä½“éªŒä¼˜åŒ–</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="æµè§ˆå™¨ä¸­çš„-event-loop"><a href="#æµè§ˆå™¨ä¸­çš„-event-loop" class="header-anchor">#</a> ğŸ“š æµè§ˆå™¨ä¸­çš„ event loop</h2> <h3 id="event-loop-ç¤ºæ„å›¾"><a href="#event-loop-ç¤ºæ„å›¾" class="header-anchor">#</a> ğŸ“˜ event loop ç¤ºæ„å›¾</h3> <p><img src="/assets/img/eventloop1.ba385118.png" alt="eventloop" title="eventloop"></p> <p>ä¸Šé¢è¿™å¼ å›¾å±•ç¤ºçš„å°±æ˜¯æµè§ˆå™¨ä¸­çš„ event loopï¼Œå®ƒåŒ…å«ä¸¤éƒ¨åˆ†ï¼š</p> <ol><li><p>å·¦è¾¹éƒ¨åˆ†æ˜¯<strong>å †ç©ºé—´å’Œæ ˆç©ºé—´</strong>ã€‚js ä»£ç è¿è¡Œæ—¶ï¼Œ<strong>åŸºç¡€å˜é‡ä¼šå­˜åœ¨æ ˆç©ºé—´é‡Œé¢ï¼Œè€Œå¤æ‚çš„å˜é‡ï¼Œæ¯”å¦‚å¯¹è±¡ã€å‡½æ•°ç­‰ä¼šå­˜åœ¨å †ç©ºé—´é‡Œ</strong>ã€‚åŒæ—¶ï¼Œ<strong>æ ˆç©ºé—´é‡Œä¹Ÿä¼šä¿å­˜ä¸€äº›å¯¹å †ç©ºé—´é‡Œçš„å˜é‡çš„å¼•ç”¨</strong>ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ<strong>æ ˆé‡Œè¿˜ä¼šå­˜å‡½æ•°çš„æ‰§è¡Œé€»è¾‘</strong>ï¼Œæ¯”å¦‚ A å‡½æ•°è°ƒç”¨ B å‡½æ•°ï¼Œé‚£ä¹ˆæ ˆç©ºé—´é‡Œå°±ä¼šæ—¢æœ‰ A åˆæœ‰ Bï¼Œå¹¶ä¸”æ˜¯å…ˆæ‰§è¡Œ A å†æ‰§è¡Œ Bï¼Œæ‰§è¡Œå®Œæˆåï¼Œå…ˆé‡Šæ”¾ Bï¼Œå†é‡Šæ”¾ Aã€‚</p></li> <li><p>ä¸‹é¢éƒ¨åˆ†æ˜¯<strong>å¼‚æ­¥é˜Ÿåˆ—</strong>ã€‚å¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰ä¸€äº›æ¯”è¾ƒè€—æ—¶çš„å¼‚æ­¥äº‹ä»¶ï¼Œæ¯”å¦‚ç‚¹å‡»äº‹ä»¶ã€ajax è¯·æ±‚ã€å®šæ—¶å™¨ç­‰ï¼Œå°±å…ˆä¼šæŠŠå®ƒä»¬æ”¾åˆ°è¿™ä¸ªå¼‚æ­¥é˜Ÿåˆ—ä¸­ã€‚å½“æ ˆé‡Œé¢çš„ä¸»çº¿ç¨‹çš„åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œå°±ä¼šæ¥å¼‚æ­¥é˜Ÿåˆ—ä¸­å–å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œã€‚ç”±äºé˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºçš„ç»“æ„ï¼Œæ‰€ä»¥<strong>å…ˆè¿›æ¥çš„å¼‚æ­¥ä»»åŠ¡ä¼šå…ˆæ‰§è¡Œ</strong>ã€‚å¦‚æœæ­¤æ—¶å¼‚æ­¥é˜Ÿåˆ—ä¸­æ²¡æœ‰å¼‚æ­¥ä»»åŠ¡ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¹Ÿä¼šå¤„äº event loop çŠ¶æ€ï¼Œå®æ—¶ç›‘å¬å¼‚æ­¥é˜Ÿåˆ—ä¸­æœ‰æ²¡æœ‰å¼‚æ­¥ä»»åŠ¡ï¼Œæœ‰çš„è¯å°±å–å‡ºæ¥æ‰§è¡Œã€‚</p></li></ol> <h3 id="å¼‚æ­¥é˜Ÿåˆ—åˆ†ç±»"><a href="#å¼‚æ­¥é˜Ÿåˆ—åˆ†ç±»" class="header-anchor">#</a> ğŸ“˜ å¼‚æ­¥é˜Ÿåˆ—åˆ†ç±»</h3> <p><img src="/assets/img/eventloop2.25d06f8b.png" alt="eventloop" title="eventloop"></p> <p>ä»»åŠ¡æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆæ˜¯å…ˆæ‰§è¡Œå®ä»»åŠ¡çš„ï¼Œå› ä¸ºæ•´ä¸ª script æ ‡ç­¾å°±æ˜¯ä¸€ä¸ªå®ä»»åŠ¡ï¼Œå½“åœ¨æ‰§è¡Œå®ä»»åŠ¡çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šè§¦å‘ä¸€äº›å¾®ä»»åŠ¡ï¼Œæ¯”å¦‚ promiseï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå…ˆå»æŠŠå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„å¾®ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šå»æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰§è¡Œå®Œæ‰€æœ‰çš„ä»»åŠ¡ã€‚</p> <h3 id="æµè§ˆå™¨ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—"><a href="#æµè§ˆå™¨ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—" class="header-anchor">#</a> ğŸ“˜ æµè§ˆå™¨ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—</h3> <p><img src="/assets/img/eventloop3.09133681.png" alt="eventloop" title="eventloop"></p> <h3 id="event-loop-ç»ƒä¹ é¢˜"><a href="#event-loop-ç»ƒä¹ é¢˜" class="header-anchor">#</a> ğŸ“˜ event loop ç»ƒä¹ é¢˜</h3> <p>ğŸ”’ <strong>1. å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡çš„æ‰§è¡Œé¡ºåº</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise init'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise result:'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼špromise initã€promise endã€promise result:1ã€timeout</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>è¿™æ®µä»£ç è¦æ³¨æ„çš„æ˜¯ promise çš„ resolve å‡½æ•°ä¸­çš„ä»£ç æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥é‡Œé¢çš„ä¸¤ä¸ª console.log ä¼šå…ˆæ‰§è¡Œã€‚ç„¶å then æ–¹æ³•è§¦å‘å¾®ä»»åŠ¡ï¼Œæœ€åå†æ‰§è¡Œå®ä»»åŠ¡ã€‚</p> <p>åŒæ­¥ä»»åŠ¡ï¼špromise initã€promise endï¼Œå¾®ä»»åŠ¡ï¼špromise result:1ã€å®ä»»åŠ¡ï¼štimeouotã€‚</p> <p>ğŸ”’ <strong>2. å®ä»»åŠ¡å¾®ä»»åŠ¡äº¤é”™æ‰§è¡Œ</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout1'</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout2'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼špromise2ã€timeout1ã€promise1ã€timeout2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>é¦–å…ˆï¼Œç¬¬ä¸€ä¸ªå®ä»»åŠ¡ setTimeout ä¼šå…ˆè¢«æ”¾åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯æš‚æ—¶ä¸ä¼šæ‰§è¡Œã€‚æ¥ç€å…ˆæ‰§è¡Œå¾®ä»»åŠ¡ promiseï¼Œæ‰“å° promise2ï¼Œæ‰§è¡Œçš„åŒæ—¶æŠŠé‡Œé¢çš„ setTimeout ä¹Ÿæ”¾åˆ°äº†å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæš‚æ—¶ä¹Ÿä¸ä¼šæ‰§è¡Œï¼Œæ­¤æ—¶è¿™ä¸ª promise å°±æ‰§è¡Œå®Œæˆäº†ã€‚ç„¶åå°±ä¼šå»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºç¬¬ä¸€ä¸ª setTimeout å‡ºæ¥æ‰§è¡Œï¼Œæ‰“å° timeout1ï¼Œæ­¤æ—¶åˆæ’å…¥äº†ä¸€ä¸ªå¾®ä»»åŠ¡ promiseï¼Œæ‰€ä»¥å°±ä¼šå…ˆæ‰§è¡Œè¿™ä¸ªå¾®ä»»åŠ¡ï¼Œæ‰“å° promise1ï¼Œæœ€åæ‰å»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºç¬¬äºŒä¸ª setTimeout æ‰§è¡Œï¼Œæ‰“å° timeout2ã€‚</p> <p>ğŸ”’ <strong>3. async/await æ‹†è§£</strong></p> <p>ğŸ”” å¦‚æœ await åæ˜¯ä¸€ä¸ªç®€å•ç±»å‹ï¼Œåˆ™è¿›è¡Œ Promise åŒ…è£¹ã€‚</p> <p>ğŸ”” å¦‚æœ await åæ˜¯ä¸€ä¸ª thenable å¯¹è±¡ï¼Œåˆ™ä¸ç”¨è¿›è¡Œ Promise åŒ…è£¹ï¼ˆchorme çš„ä¼˜åŒ–ï¼‰ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token number">1234</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼š1234</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä¸Šé¢çš„ä»£ç æ‰“å°å‡º1234ï¼Œè¯´æ˜ async è¿”å›çš„æ˜¯ä¸€ä¸ª promise å¯¹è±¡ï¼Œä¸Šé¢çš„ä»£ç ç­‰ä»·äºä¸‹é¢è¿™æ ·ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼š1234</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>await thenable</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼š1234</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>await ä¸åŠ ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ‰§è¡Œç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼š1234</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªåŒ…å« then æ–¹æ³•çš„å¯¹è±¡ï¼ˆå³ thenable å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆæ ¹æ® promise A+ è§„èŒƒä¼šå°†å®ƒå½“æˆä¸€ä¸ª promise å¯¹è±¡å»å¤„ç†ï¼Œè°ƒç”¨é‡Œé¢çš„ then æ–¹æ³•è¾“å‡º resolve çš„å†…å®¹ã€‚</p> <p>å¦‚æœ resolve è¿”å›å€¼è¿˜æ˜¯ä¸€ä¸ªåŒ…å« then æ–¹æ³•çš„å¯¹è±¡ï¼Œé‚£ä¹ˆä¼šç»§ç»­é€’å½’è°ƒç”¨ promise.thenï¼Œç›´åˆ° resolve è¿”å›å€¼æ˜¯ä¸€ä¸ªåŸºç¡€ç±»å‹ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">r</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼š1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>ğŸ”’ <strong>4. ä½¿ç”¨ async await é¡ºåºåˆ¤æ–­ï¼ˆå­¦ä¼šå°† async/await è½¬æ¢æˆ Promise æ¥è§£å†³ï¼‰</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼šasync1 startã€async2ã€scriptã€async1 end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>async1 ä¸­çš„ç¬¬ä¸€ä¸ª console å’Œ async2 ä¸­çš„ console éƒ½æ˜¯åŒæ­¥ä»»åŠ¡ï¼Œå› ä¸º async è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œä¸Šé¢è¯´è¿‡ï¼Œpromise çš„ resolve ä¸­çš„ä»£ç éƒ½æ˜¯åŒæ­¥ä»»åŠ¡ã€‚æ‰€ä»¥è¿™ä¸¤è€…ä¼šå…ˆæ‰§è¡Œï¼Œæ¥ç€æ‰§è¡Œ console.log('script') è¿™ä¸ªåŒæ­¥ä»»åŠ¡ï¼Œæœ€åæ‰æ‰§è¡Œ async1 ä¸­çš„ç¬¬äºŒä¸ª consoleï¼ˆå¾®ä»»åŠ¡ï¼‰ã€‚</p> <p>å¯ä»¥å°† async2 è½¬æ¢æˆä¸€ä¸ª Promise å¯¹è±¡ï¼Œå°±å®¹æ˜“ç†è§£äº†ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼šasync1 startã€async2ã€scriptã€async1 end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ğŸ”’ <strong>5. å¦‚æœ promise æ²¡æœ‰ resolve æˆ– reject</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 success'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'async1 end'</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰§è¡Œç»“æœï¼šscript startã€async1 startã€promise1ã€script end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ğŸ”” ç”±äº promise å¯¹è±¡æ²¡æœ‰æ‰§è¡Œ resolve æˆ–è€… reject æ–¹æ³•ï¼Œå¯¼è‡´å®ƒçš„çŠ¶æ€æ²¡æœ‰å˜æ›´ï¼Œè¿™ä¸ª promise æ°¸è¿œæ²¡æœ‰å®Œæˆï¼Œæ‰€ä»¥ await ä¸‹è¾¹çš„ä»£ç å°±æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œawait ä¸‹é¢çš„ä»£ç ç­‰åˆ°å®ƒè¿”å›çš„ peomise å¯¹è±¡çš„çŠ¶æ€å˜æ›´äº†æ‰ä¼šæ‰§è¡Œï¼Œå¦åˆ™æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚</p> <p>ğŸ”’ <strong>6. æŸå¤§å‚çš„çœŸå®é¢è¯•é¢˜</strong></p> <p>é€šè¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œè¿™é“é¢˜æˆ‘è‡ªå·±ç­”å¯¹äº†å“ˆå“ˆå“ˆï½ ğŸ˜„</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
    <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span> <span class="token comment">// 10</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span> <span class="token comment">// 7</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise3'</span><span class="token punctuation">)</span> <span class="token comment">// 8</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise4'</span><span class="token punctuation">)</span> <span class="token comment">// 9</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p> <p><img src="/assets/img/eventloop4.a6def6e7.png" alt="eventloop" title="eventloop"></p> <p>ğŸ”’ <strong>7. resolve å¤„ç† thenableï¼Œä¹Ÿä¼šåŒ…è£¹ä¸€å±‚ promiseã€‚</strong></p> <p>è¿™é“é¢˜æ˜¯ç¬¬6é¢˜çš„å˜ç§ã€‚</p> <p>è¿™é“é¢˜æˆ‘ä¹Ÿç­”å¯¹äº†å“ˆå“ˆå“ˆï½ ğŸ˜„</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span> <span class="token comment">// 8</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise3'</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise4'</span><span class="token punctuation">)</span> <span class="token comment">// 7</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>æ¥ä¸‹æ¥å¯¹è¿™æ®µä»£ç æ”¹åŠ¨ä¸‹ï¼š</p> <p>åœ¨ async2 å‰é¢åŠ ä¸Š asyncã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span> <span class="token comment">// 8</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise3'</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise4'</span><span class="token punctuation">)</span> <span class="token comment">// 7</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶ â€˜async1 endâ€™ å‡ºç°çš„ä½ç½®å˜æˆäº†åœ¨ â€˜peomise3â€™ å’Œ â€˜promise4â€™ ä¹‹é—´äº†ã€‚</p> <p>ğŸ”” è¿™æ˜¯å› ä¸º <strong>async2 å‰é¢åŠ äº† async ä¹‹åï¼Œä¼šè¿”å›ä¸€ä¸ª promiseï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶å®ƒæœ¬èº«æ˜¯ä¸€ä¸ª promiseï¼Œåœ¨ async1 å†…éƒ¨ resolve å¤„ç† thenable æ—¶åˆä¼šå†åŒ…è£¹ä¸€å±‚ promise</strong>ï¼Œæ‰€ä»¥å®ƒä¸‹é¢çš„ä»£ç å°±ä¼šæ¯”ä¹‹å‰æ…¢äº†ä¸¤ä¸ªä½ç½®è¾“å‡ºã€‚</p> <p>å†æ”¹ä¸€ä¸‹ï¼š</p> <p>async2 å†…éƒ¨è¿”å›ä¸€ä¸ª thanable å¯¹è±¡</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">r</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span> <span class="token comment">// 8</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise3'</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise4'</span><span class="token punctuation">)</span> <span class="token comment">// 7</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>æ­¤æ—¶ â€˜async1 endâ€™ å‡ºç°çš„ä½ç½®å˜æˆåœ¨ â€˜peomise2â€™ å’Œ â€˜promise3â€™ ä¹‹é—´äº†ã€‚</p> <p>è¿™æ˜¯å› ä¸º <strong>async2 é‡Œé¢è¿”å›äº†ä¸€ä¸ª thenable å¯¹è±¡ï¼Œæ­¤æ—¶è™½ç„¶å®ƒæœ¬èº«ä¸æ˜¯ä¸€ä¸ª promise äº†ï¼Œä½†æ˜¯åœ¨ async1 å†…éƒ¨ resolve å¤„ç† thenable æ—¶è¿˜æ˜¯ä¼šåŒ…è£¹ä¸€å±‚ promise</strong>ï¼Œæ‰€ä»¥å®ƒä¸‹é¢çš„ä»£ç å°±ä¼šæ¯”ä¹‹å‰æ…¢äº†ä¸€ä¸ªä½ç½®è¾“å‡ºã€‚</p> <p>å¦‚æœ async2 é‡Œé¢è¿”å›çš„æ˜¯ä¸€ä¸ªåŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚ return 1ï¼Œé‚£ä¹ˆè¾“å‡ºç»“æœå°±ä¼šè·Ÿç¬¬ä¸€æ¬¡çš„ä¸€æ ·ã€‚</p> <h2 id="node-js-ä¸­çš„-event-loop"><a href="#node-js-ä¸­çš„-event-loop" class="header-anchor">#</a> ğŸ“š Node.js ä¸­çš„ event loop</h2> <h3 id="æ•´ä½“æµç¨‹å›¾"><a href="#æ•´ä½“æµç¨‹å›¾" class="header-anchor">#</a> ğŸ“˜ æ•´ä½“æµç¨‹å›¾</h3> <p><img src="/assets/img/eventloop5.b8ec1662.png" alt="eventloop" title="eventloop"></p> <h3 id="å¼‚æ­¥æ‰§è¡Œé˜Ÿåˆ—é˜¶æ®µ"><a href="#å¼‚æ­¥æ‰§è¡Œé˜Ÿåˆ—é˜¶æ®µ" class="header-anchor">#</a> ğŸ“˜ å¼‚æ­¥æ‰§è¡Œé˜Ÿåˆ—é˜¶æ®µ</h3> <p>æˆ‘ä»¬ä¸»è¦å…³å¿ƒçº¢æ¡†æ¡†å‡ºæ¥çš„ä¸‰éƒ¨åˆ†ã€‚</p> <p><img src="/assets/img/eventloop6.def2a895.png" alt="eventloop" title="eventloop"></p> <h3 id="node-js-ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—"><a href="#node-js-ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—" class="header-anchor">#</a> ğŸ“˜ Node.js ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—</h3> <p><img src="/assets/img/eventloop7.5cc11323.png" alt="eventloop" title="eventloop"></p> <h3 id="node-js-ä¸­çš„ä»»åŠ¡æ¯”è¾ƒ"><a href="#node-js-ä¸­çš„ä»»åŠ¡æ¯”è¾ƒ" class="header-anchor">#</a> ğŸ“˜ Node.js ä¸­çš„ä»»åŠ¡æ¯”è¾ƒ</h3> <p><img src="/assets/img/eventloop8.120f3a38.png" alt="eventloop" title="eventloop"></p> <h3 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="header-anchor">#</a> ğŸ“˜ ç»ƒä¹ é¢˜</h3> <p>ğŸ”’ <strong>1. æ¯”è¾ƒ setImmediate å’Œ setTimeout çš„æ‰§è¡Œé¡ºåº</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p> <p><img src="/assets/img/eventloop9.749159de.png" alt="eventloop" title="eventloop"></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€å¼€å§‹æ‰§è¡Œçš„æ—¶å€™éƒ½æ˜¯å…ˆè¾“å‡º setTimeoutï¼Œä½†æ˜¯åé¢çªç„¶å°±å…ˆè¾“å‡º setImmediateäº†ã€‚æ‰€ä»¥è¯´æ˜è¿™ä¸¤ä¸ªçš„æ‰§è¡Œé¡ºåºæ˜¯ä¸å›ºå®šçš„ï¼Œè·Ÿæœºå™¨çš„æ€§èƒ½æœ‰å…³ã€‚</p> <p>ğŸ”” setTimeout æ˜¯åœ¨ timers é˜¶æ®µæ‰§è¡Œçš„ï¼ŒsetImmediate æ˜¯åœ¨ check é˜¶æ®µæ‰§è¡Œçš„ã€‚</p> <p>å¦‚æœ setTimeout å…ˆåŠ å…¥åˆ° timers ä¸­ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå®Œ poll é˜¶æ®µåï¼Œå°±ä¼šå…ˆæ‰§è¡Œ timers ï¼Œå†æ‰§è¡Œ checkã€‚å¦åˆ™çš„è¯å°±ä¼šå…ˆæ‰§è¡Œ check å†æ‰§è¡Œ timersã€‚</p> <p>ğŸ”’ <strong>2. å¦‚æœä¸¤è€…éƒ½åœ¨ poll é˜¶æ®µæ³¨å†Œï¼Œé‚£ä¹ˆé¡ºåºå°±èƒ½ç¡®å®š</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./test.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p> <p><img src="/assets/img/eventloop10.dc0c3f0c.png" alt="eventloop" title="eventloop"></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æ‰§è¡Œå‡ æ¬¡ï¼Œè¾“å‡ºé¡ºåºå°±æ˜¯å›ºå®šçš„äº†ï¼Œæ€»æ˜¯å…ˆè¾“å‡º setImmediateï¼Œå†è¾“å‡º setTimeoutã€‚</p> <p>è¿™æ˜¯å› ä¸ºä¸¤è€…éƒ½æ˜¯åœ¨ poll é˜¶æ®µæ³¨å†Œçš„ï¼Œé‚£ä¹ˆ timers é˜¶æ®µè‚¯å®šæ¥ä¸åŠåŠ å…¥ setTimeoutï¼Œæ‰€ä»¥ poll é˜¶æ®µæ‰§è¡Œå®Œæ¯•åï¼Œå°±æ‰§è¡Œ check é˜¶æ®µã€‚</p> <p>ğŸ”’ <strong>3. ç†è§£ process.nextTick</strong></p> <p>æ¯ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œå®Œæˆä¹‹åï¼Œåœ¨å½“å‰é˜¶æ®µå°¾éƒ¨è§¦å‘ nextTickã€‚</p> <p>æ¡ˆä¾‹ï¼šå¸¸è§çš„ node.js å›è°ƒå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯æŠ›å‡ºçš„é”™è¯¯ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">apiCall</span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> arg <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span>
            callback<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'argument should be string'</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ğŸ”” node.js æ‰€æœ‰ api çš„å›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯é”™è¯¯å¯¹è±¡ errã€‚</p> <p>ğŸ”’ <strong>4. æ¯”è¾ƒ process.nextTick å’Œ setImmediate</strong></p> <p>ğŸ”” process.nextTick() åœ¨åŒä¸€ä¸ªé˜¶æ®µå°¾éƒ¨ç«‹å³æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªé˜¶æ®µçš„å¼€å§‹ä¹‹å‰éƒ½ä¼šæ‰§è¡Œã€‚æ¯”å¦‚ä» poll é˜¶æ®µåˆ° check é˜¶æ®µï¼Œè‚¯å®šä¼šå…ˆæ‰§è¡Œ process.nextTick()ã€‚</p> <p>ğŸ”” setImmediate() åœ¨äº‹ä»¶å¾ªç¯çš„ check é˜¶æ®µè§¦å‘ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nextTick'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p> <p><img src="/assets/img/eventloop11.00867a94.png" alt="eventloop" title="eventloop"></p> <p>å¯ä»¥çœ‹åˆ°ï¼ŒnextTick æ¯æ¬¡éƒ½æ¯” setImmediate å…ˆè¾“å‡ºã€‚</p> <h3 id="ä¸åŒ-node-ç‰ˆæœ¬çš„-event-loop"><a href="#ä¸åŒ-node-ç‰ˆæœ¬çš„-event-loop" class="header-anchor">#</a> ğŸ“˜ ä¸åŒ Node ç‰ˆæœ¬çš„ event loop</h3> <p><img src="/assets/img/eventloop12.bdb709c7.png" alt="eventloop" title="eventloop"></p> <h3 id="å…³äºä¸åŒç‰ˆæœ¬å˜åŒ–çš„å‡ ä¸ª-demo"><a href="#å…³äºä¸åŒç‰ˆæœ¬å˜åŒ–çš„å‡ ä¸ª-demo" class="header-anchor">#</a> ğŸ“˜ å…³äºä¸åŒç‰ˆæœ¬å˜åŒ–çš„å‡ ä¸ª demo</h3> <p>ğŸ”’ <strong>timers é˜¶æ®µçš„æ‰§è¡Œæ—¶æœºå˜åŒ–</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer1'</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer2'</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>æ‰§è¡Œç»“æœï¼š</p> <p>node11 ä¹‹å‰ï¼štimer1ã€timer2ã€promise1ã€promise2ï¼›</p> <p>node11 ä¹‹åï¼štimer1ã€promise1ã€timer2ã€promise2ã€‚</p> <p>ğŸ”’ <strong>check é˜¶æ®µçš„æ‰§è¡Œæ—¶æœºå˜åŒ–</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate2'</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise resolve'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate4'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æ‰§è¡Œç»“æœï¼š</p> <p>node11 ä¹‹å‰ï¼šimmediate1ã€immediate2ã€immediate3ã€immediate4ã€promise resolveï¼›</p> <p>node11 ä¹‹åï¼šimmediate1ã€immediate2ã€promise resolveã€immediate3ã€immediate4ã€‚</p> <p>ğŸ”’ <strong>nextTick é˜Ÿåˆ—çš„æ‰§è¡Œæ—¶æœºå˜åŒ–</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate2'</span><span class="token punctuation">)</span>
    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nextTick'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate4'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æ‰§è¡Œç»“æœï¼š</p> <p>node11 ä¹‹å‰ï¼šimmediate1ã€immediate2ã€immediate3ã€immediate4ã€nextTickï¼›</p> <p>node11 ä¹‹åï¼šimmediate1ã€immediate2ã€nextTickã€immediate3ã€immediate4ã€‚</p> <p>ğŸ”” <strong>ä»è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œéšç€ node ç‰ˆæœ¬çš„å‡é«˜ï¼Œå®ƒçš„ event loop çš„è¡¨ç°è·Ÿæµè§ˆå™¨çš„ä¿æŒä¸€è‡´</strong>ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/javascript/promise.html" class="prev">
        æ‰‹å†™Promise
      </a></span> <span class="next"><a href="/javascript/jsUtils.html">
        JavaScriptå¸¸ç”¨å·¥å…·æ–¹æ³•
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.83f3402d.js" defer></script><script src="/assets/js/2.a0a69aa9.js" defer></script><script src="/assets/js/14.32d895c9.js" defer></script>
  </body>
</html>
