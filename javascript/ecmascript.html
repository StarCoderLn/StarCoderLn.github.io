<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>提案到入选ECMA规范 | 鸵鸟蛋的个人主页</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/image/logo.jpg">
    <meta name="description" content="鸵鸟蛋的世界">
    <link rel="preload" href="/assets/css/0.styles.22095322.css" as="style"><link rel="preload" href="/assets/js/app.83f3402d.js" as="script"><link rel="preload" href="/assets/js/2.a0a69aa9.js" as="script"><link rel="preload" href="/assets/js/36.a4d7a3e2.js" as="script"><link rel="prefetch" href="/assets/js/10.439f342d.js"><link rel="prefetch" href="/assets/js/11.216a07f2.js"><link rel="prefetch" href="/assets/js/12.a66aca6c.js"><link rel="prefetch" href="/assets/js/13.f5f24ce3.js"><link rel="prefetch" href="/assets/js/14.32d895c9.js"><link rel="prefetch" href="/assets/js/15.623a8373.js"><link rel="prefetch" href="/assets/js/16.31912b5c.js"><link rel="prefetch" href="/assets/js/17.68031807.js"><link rel="prefetch" href="/assets/js/18.a66b9dd4.js"><link rel="prefetch" href="/assets/js/19.c3c1ad4e.js"><link rel="prefetch" href="/assets/js/20.67c9540c.js"><link rel="prefetch" href="/assets/js/21.722fe9fe.js"><link rel="prefetch" href="/assets/js/22.72f8f629.js"><link rel="prefetch" href="/assets/js/23.f730e8f1.js"><link rel="prefetch" href="/assets/js/24.9e67058b.js"><link rel="prefetch" href="/assets/js/25.81a3aeea.js"><link rel="prefetch" href="/assets/js/26.18ba7257.js"><link rel="prefetch" href="/assets/js/27.eee6c364.js"><link rel="prefetch" href="/assets/js/28.d2732972.js"><link rel="prefetch" href="/assets/js/29.d54fb216.js"><link rel="prefetch" href="/assets/js/3.8959ecef.js"><link rel="prefetch" href="/assets/js/30.e71f561f.js"><link rel="prefetch" href="/assets/js/31.4f56f5c3.js"><link rel="prefetch" href="/assets/js/32.4ecd4417.js"><link rel="prefetch" href="/assets/js/33.32d721bd.js"><link rel="prefetch" href="/assets/js/34.ab789bed.js"><link rel="prefetch" href="/assets/js/35.e2330e74.js"><link rel="prefetch" href="/assets/js/37.ca9e6d12.js"><link rel="prefetch" href="/assets/js/38.8e7d9dae.js"><link rel="prefetch" href="/assets/js/39.818446de.js"><link rel="prefetch" href="/assets/js/4.bc08363f.js"><link rel="prefetch" href="/assets/js/40.6e5412c0.js"><link rel="prefetch" href="/assets/js/41.c046cc2c.js"><link rel="prefetch" href="/assets/js/42.3a98e5b0.js"><link rel="prefetch" href="/assets/js/43.c48084fd.js"><link rel="prefetch" href="/assets/js/44.9a68e6e8.js"><link rel="prefetch" href="/assets/js/45.607f9d7b.js"><link rel="prefetch" href="/assets/js/46.4fbd5727.js"><link rel="prefetch" href="/assets/js/47.ff6cd126.js"><link rel="prefetch" href="/assets/js/48.4e44b645.js"><link rel="prefetch" href="/assets/js/49.b3559737.js"><link rel="prefetch" href="/assets/js/5.247f2124.js"><link rel="prefetch" href="/assets/js/50.4c05ad25.js"><link rel="prefetch" href="/assets/js/51.27325a7b.js"><link rel="prefetch" href="/assets/js/52.62b7f674.js"><link rel="prefetch" href="/assets/js/53.fe6c2e96.js"><link rel="prefetch" href="/assets/js/54.68c91b01.js"><link rel="prefetch" href="/assets/js/55.a4e116a4.js"><link rel="prefetch" href="/assets/js/56.adec72d4.js"><link rel="prefetch" href="/assets/js/57.c8755c55.js"><link rel="prefetch" href="/assets/js/58.99e5de2f.js"><link rel="prefetch" href="/assets/js/59.f7deea0d.js"><link rel="prefetch" href="/assets/js/6.9cd44cad.js"><link rel="prefetch" href="/assets/js/60.608e9336.js"><link rel="prefetch" href="/assets/js/7.d1cbdc31.js"><link rel="prefetch" href="/assets/js/8.3e9a3d41.js"><link rel="prefetch" href="/assets/js/9.698ca62a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.22095322.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">鸵鸟蛋的个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://starcoderln.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/StarCoderLn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://starcoderln.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/StarCoderLn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VuePress</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>函数式编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面向切面编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javascript/jsUnknow1.html" class="sidebar-link">你不知道的JavaScript（上）</a></li><li><a href="/javascript/ecmascript.html" class="active sidebar-link">ECMAScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#提案到入选ecma规范" class="sidebar-link">提案到入选ECMA规范</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#es7-es10-新特性速览" class="sidebar-link">ES7~ES10 新特性速览</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#es7-新特性" class="sidebar-link">ES7 新特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#includes" class="sidebar-link">includes</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#幂运算" class="sidebar-link">幂运算</a></li></ul></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#es8-新特性" class="sidebar-link">ES8 新特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#async-await" class="sidebar-link">async/await</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#object-values" class="sidebar-link">Object.values()</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#object-entries" class="sidebar-link">Object.entries()</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#string-padding" class="sidebar-link">String Padding</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#结尾允许逗号" class="sidebar-link">结尾允许逗号</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#object-getownpropertydescriptors" class="sidebar-link">Object.getOwnPropertyDescriptors()</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#sharedarraybuffer-与-atomics" class="sidebar-link">SharedArrayBuffer 与 Atomics</a></li></ul></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#es9-新特性" class="sidebar-link">ES9 新特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#异步迭代器和异步生成器" class="sidebar-link">异步迭代器和异步生成器</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#promise-finally" class="sidebar-link">Promise.finally</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#rest-spread" class="sidebar-link">Rest/Spread</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#对正则表达式增强" class="sidebar-link">对正则表达式增强</a></li></ul></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#es10-新特性" class="sidebar-link">ES10 新特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#flat-和-flatmap" class="sidebar-link">flat() 和 flatMap()</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#object-fromentries" class="sidebar-link">Object.fromEntries()</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#string-prototype-matchall" class="sidebar-link">String.prototype.matchAll()</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#string-prototype-trimstart-和-string-prototype-trimend" class="sidebar-link">String.prototype.trimStart() 和 String.prototype.trimEnd()</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#string-prototype-description" class="sidebar-link">String.prototype.description</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#省略-catch-参数" class="sidebar-link">省略 catch 参数</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#行分隔符（u-2028）和段分隔符（u-2029）符号现在允许在字符串文字中，与-json-匹配" class="sidebar-link">行分隔符（U + 2028）和段分隔符（U + 2029）符号现在允许在字符串文字中，与 JSON 匹配</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#更加友好的-json-stringify" class="sidebar-link">更加友好的 JSON.stringify</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#function-prototype-tostring" class="sidebar-link">Function.prototype.toString()</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#bigint-任意精度整数" class="sidebar-link">BigInt —— 任意精度整数</a></li><li class="sidebar-sub-header"><a href="/javascript/ecmascript.html#标准化-globalthis-对象" class="sidebar-link">标准化 globalThis 对象</a></li></ul></li></ul></li><li><a href="/javascript/promise.html" class="sidebar-link">手写Promise</a></li><li><a href="/javascript/eventloop.html" class="sidebar-link">Event loop 总结</a></li><li><a href="/javascript/jsUtils.html" class="sidebar-link">JavaScript常用工具方法</a></li><li><a href="/javascript/qa.html" class="sidebar-link">JavaScript与QA工程师</a></li><li><a href="/javascript/jsTest.html" class="sidebar-link">JavaScript基础测试</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端监控</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法学习总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac 开发体验优化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="提案到入选ecma规范"><a href="#提案到入选ecma规范" class="header-anchor">#</a> 提案到入选ECMA规范</h2> <ul><li>Stage 0：strawman--最初想法的提交</li> <li>Stage 1：proposal(提案)--由 TC39 至少一名成员倡导的正式提案文件，该文件包括 API 实例</li> <li>Stage 2：draft(草案)--功能规范的初始版本，该版本包含功能规范的两个实验实现</li> <li>Stage 3：candidate(候选)--提案规范通过审查并从厂商那里收集反馈</li> <li>Stage 4：finished(完成)--提案准备加入 ECMAScript，但是到浏览器或者 Nodejs 中可能需要更长的时间</li></ul> <h2 id="es7-es10-新特性速览"><a href="#es7-es10-新特性速览" class="header-anchor">#</a> ES7~ES10 新特性速览</h2> <table><thead><tr><th>ECMAScript版本</th> <th>新增特性</th></tr></thead> <tbody><tr><td>ECMAScript2016(ES7)</td> <td>在 ES6 基础上新增了两项功能，一个是数组的 <code>includes</code> 方法，一个是 <code>Math.pow</code> 的简写语法</td></tr> <tr><td>ECMAScript2017(ES8)</td> <td>在异步操作、Object、String 能力上做了进一步增强，让代码编写更加效率</td></tr> <tr><td>ECMAScript2018(ES9)</td> <td>主要解决了遍历中异步、异步的归一操作等问题，也提供了对象的拷贝、筛选功能并且提升了正则的处理能力</td></tr> <tr><td>ECMAScript2019(ES10)</td> <td>ES10 虽然没有大幅的改动，JSON 问题修复，数组、字符串、对象、函数等能力进一步增强，同时新增的 <code>BigInt</code> 数据类型也格外引人注目</td></tr></tbody></table> <h2 id="es7-新特性"><a href="#es7-新特性" class="header-anchor">#</a> ES7 新特性</h2> <h3 id="includes"><a href="#includes" class="header-anchor">#</a> includes</h3> <p>用来判断一个元素是否存在一个数组中</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// false，之前的做法</span>
arr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false，现在的做法</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="幂运算"><a href="#幂运算" class="header-anchor">#</a> 幂运算</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8，之前的做法</span>
<span class="token number">2</span> <span class="token operator">**</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 8，现在的做法</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="es8-新特性"><a href="#es8-新特性" class="header-anchor">#</a> ES8 新特性</h2> <h3 id="async-await"><a href="#async-await" class="header-anchor">#</a> async/await</h3> <p>ES8 的异步操作，比如 async/await，它的 next 返回的是一个 promise 对象。在 async/await 之前，我们实现异步操作一般是通过<strong>嵌套回调</strong>、<code>Promise</code>、<code>Generator</code> 来实现。现在主要是通过 async/await + Promise。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 使用 async 声明一个异步函数</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// await 会等待异步函数执行完毕，再继续执行下面的代码</span>
  <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>async/await 的代码看起来更加语义化，可读性更好。</p> <ul><li>async</li></ul> <p>返回的是一个 Promise 对象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> num <span class="token operator">+</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回的是一个promise对象</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>await</li></ul> <p>（1）await 会强制它后面的代码进行等待，直到 Promise 执行完毕。<br>
（2）await 只能在 async 声明的函数内部使用，否则会报错。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 拿到异步函数返回的结果</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'异步代码执行完毕'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 等待1.5秒后输出'异步代码执行完毕 result'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>错误处理</li></ul> <p>（1）使用 try...catch... 捕获错误</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'错误信息'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我在错误下边不会执行'</span><span class="token punctuation">)</span> <span class="token comment">// 这句代码不会执行</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 等待1.5秒后打印出“错误信息”，说明捕获到错误了</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>（2）另外一种捕获错误的方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'错误信息'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我在错误下边不会执行'</span><span class="token punctuation">)</span> <span class="token comment">// 这句代码不会执行</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// 等待1.5秒后打印出“错误信息”，说明捕获到错误了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>（3）如果不想中断错误后面的代码，想要继续执行的话，可以提前在 await 那里把错误捕获，下面的代码就会继续执行了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'错误信息'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我在错误下边还是会继续执行'</span><span class="token punctuation">)</span> <span class="token comment">// 这句代码会继续执行</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 等待1.5秒后打印出“错误信息”和“我在错误下边还是会继续执行”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>多个异步命令</li></ul> <p>如果多个异步命令之间是独立的，我们可以让它们同时执行，而不必等其中某一个执行完毕后再执行下一个，可以减少等待时间。</p> <p><code>console.time()</code> 和 <code>console.timeEnd()</code> 可以用来测试它们中间的代码的执行时间。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">promiseFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;fn1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">promiseFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;fn1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 打印出来的时间差不多是3秒，是两个异步函数等待时间的累加</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>可以通过 promise.all() 方法让多个异步命令同时执行。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">promiseFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;fn2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>res1<span class="token punctuation">,</span> res2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">promiseFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">promiseFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;fn2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 打印出来的时间差不多是2秒，说明是同步执行的，取等待时间最长的异步函数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="object-values"><a href="#object-values" class="header-anchor">#</a> Object.values()</h3> <p>返回的是对象自身的属性值，不包括继承过来的值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;深圳&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span>

<span class="token comment">// 之前获取对象属性值的方式</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [&quot;深圳&quot;, 30]</span>

<span class="token comment">// ES8 获取对象属性值的方式</span>
Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// [&quot;深圳&quot;, 30]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="object-entries"><a href="#object-entries" class="header-anchor">#</a> Object.entries()</h3> <p>作用跟 for...in 类似，两者的区别是 for...in 会枚举原型链中的属性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;深圳&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// [[&quot;name&quot;, &quot;深圳&quot;], [&quot;age&quot;, 30]]</span>

<span class="token comment">// 如果是作用于非对象上，会强制转换成键值对形式。</span>
Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token string">'深圳'</span><span class="token punctuation">)</span> <span class="token comment">// [[&quot;0&quot;, &quot;深&quot;], [&quot;1&quot;, &quot;圳&quot;]]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>遍历对象的键值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;深圳&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 或</span>
Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="string-padding"><a href="#string-padding" class="header-anchor">#</a> String Padding</h3> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/padStart" target="_blank" rel="noopener noreferrer">String.prototype.padStart(targetLength [, padString])<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，从字符串开头开始填充</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/padEnd" target="_blank" rel="noopener noreferrer">String.prototype.padEnd(targetLength [, padString])<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，从字符串末尾开始填充</li></ul> <p>targetLength 是当前字符串需要填充到的长度。如果这个数值小于当前字符串的长度，则返回当前字符串本身。</p> <p>padString 是要填充的字符串。如果字符串太长，使填充后的字符串长度超过了目标长度，则<strong>只保留最左侧的部分</strong>，其他部分会被截断。缺省值为&quot;&quot;。</p> <h3 id="结尾允许逗号"><a href="#结尾允许逗号" class="header-anchor">#</a> 结尾允许逗号</h3> <p>这种格式会比较友好</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>
  <span class="token parameter">para1<span class="token punctuation">,</span>
  para<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>para1<span class="token punctuation">,</span>para<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  m<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
  n<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="object-getownpropertydescriptors"><a href="#object-getownpropertydescriptors" class="header-anchor">#</a> Object.getOwnPropertyDescriptors()</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptors" target="_blank" rel="noopener noreferrer">Object.getOwnPropertyDescriptors()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法用来获取一个对象的所有自身属性的描述符。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;深圳&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;fn&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptors</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
  {name: {…}, fn: {…}}
    name:
      value: &quot;深圳&quot;
      writable: true
      enumerable: true
      configurable: true
      __proto__: Object
    fn:
      get: ƒ fn()
      set: undefined
      enumerable: true
      configurable: true
      __proto__: Object
      __proto__: Object
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="sharedarraybuffer-与-atomics"><a href="#sharedarraybuffer-与-atomics" class="header-anchor">#</a> SharedArrayBuffer 与 Atomics</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer" target="_blank" rel="noopener noreferrer">SharedArrayBuffer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 可以理解成共享内存，<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics" target="_blank" rel="noopener noreferrer">Atomics<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 则提供了一组静态方法来对 SharedArrayBuffer 进行原子操作。这给 js 带来了多线程的功能，是 js 中的高级特性，也是 js 引擎的核心改进。但既然有多线程，那么就会有竞争问题，所以就需要原子操作来解决这个问题，原子操作可以理解成给线程加锁。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">// 缓冲区大小，以字节byte为单位</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span> <span class="token comment">// 8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>下面这个例子展示了 SharedArrayBuffer 共享内存用于线程间通信的使用方法。使用流程如下：</p> <p>新建共享内存 -&gt; 新建视图 -&gt; 将共享内存地址发送给其他线程 -&gt; 其他线程就可以对这块共享内存中的数据进行读写 -&gt; 读写完毕后，在主线程中都可以拿到修改后的数据</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'./worker.js'</span><span class="token punctuation">)</span> <span class="token comment">// 创建一个 worker 线程</span>
<span class="token keyword">const</span> sharedBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedArrayBuffer</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">// 新建1kb内存，SharedArrayBuffer 和 ArrayBuffer 本身是没法进行读写的</span>
<span class="token keyword">const</span> intArrBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int32Array</span><span class="token punctuation">(</span>sharedBuffer<span class="token punctuation">)</span> <span class="token comment">// 建视图，长度为256</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> intArrBuffer<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  intArrBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token comment">// 写入数据。写入数据前必须先建立视图，数据才能被写入</span>
<span class="token punctuation">}</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>sharedBuffer<span class="token punctuation">)</span> <span class="token comment">// 发送共享内存地址</span>

worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更改后的数据为：'</span> <span class="token operator">+</span> intArrBuffer<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 主线程可以直接获取到更改后的数据</span>
<span class="token punctuation">}</span>

<span class="token comment">// worker.js</span>
<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> arrBuffer <span class="token operator">=</span> e<span class="token punctuation">.</span>data
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arrBuffer<span class="token punctuation">)</span> <span class="token comment">// 打印出来的东西就是跟主线程共享的那块内存地址。如果此时主线程往内存地址中写入了数据，那么在worker线程直接就可共享，直接读取就可以了</span>

  arrBuffer<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">88</span> <span class="token comment">// worker 线程更改共享内存的数据，不用重新发送共享内存地址</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>在上面的例子中，我们直接读取和修改了共享内存的数据，其实这是错误的操作方式，如果有多个线程同时这么做，那么就会有冲突。我们应该使用 Atomics 提供的方法来操作数据。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Atomics<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>arrBuffer<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">// 读数据方法</span>
Atomics<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span>arrBuffer<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span> <span class="token comment">// 88 写数据方法，并返回写入的值</span>
Atomics<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span>arrBuffer<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span> <span class="token comment">// 88 写数据方法，并返回被替换的值</span>

Atomics<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>arrBuffer<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token comment">// 当满足共享内存地址第11位的数据是11的时候进入休眠状态</span>
Atomics<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>arrBuffer<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span> <span class="token comment">// 可以通过第四个参数唤醒休眠，比如这里2秒后自动唤醒</span>
Atomics<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span>intArrBuffer<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 该方法仅在共享的 Int32Array 下可用。三个参数：共享内存的视图、视图数据的位置、唤醒的线程数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><a href="http://www.ruanyifeng.com/blog/2018/07/web-worker.html" target="_blank" rel="noopener noreferrer">Web Worker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>也可以为JavaScript创造多线程环境，它是通过 postMessage 进行通信。这个也需要了解学习下。</p> <p>下面这个例子展示了主线程和 Worker 线程之间如何进行通信。通信之间的数据可以是任意格式的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'./worker.js'</span><span class="token punctuation">)</span> <span class="token comment">// 创建一个 worker 线程</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Hello, I am main'</span><span class="token punctuation">)</span> <span class="token comment">// 使用 postMessage 向 worker 线程发送消息</span>
worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token comment">// 接收到 worker 线程发送的消息，打印 Hello, I am worker</span>
<span class="token punctuation">}</span>

<span class="token comment">// worker.js</span>
<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token comment">// 接收到主线程发送的消息，打印 Hello, I am main</span>
  <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Hello, I am worker'</span><span class="token punctuation">)</span> <span class="token comment">// 使用 postMessage 向主线程发送消息</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>验证这个例子时需要启动一个服务才行。我们可以使用 <a href="https://juejin.im/post/5d8474baf265da03e4679a44" target="_blank" rel="noopener noreferrer">http-server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来启动一个本地服务。启动服务之后，访问页面就不能按照平时那种方式直接默认浏览器打开了，而是应该通过 http-server 的启动服务界面打开。</p> <p><img src="/assets/img/http-server1.f79f1ea6.png" alt="http-server" title="http-server"></p> <p>找到对应的文件夹，一步一步找到相应的页面，然后打开就可以看到线程间的通信了。</p> <p><img src="data:image/png;base64,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" alt="http-server" title="http-server"></p> <h2 id="es9-新特性"><a href="#es9-新特性" class="header-anchor">#</a> ES9 新特性</h2> <h3 id="异步迭代器和异步生成器"><a href="#异步迭代器和异步生成器" class="header-anchor">#</a> 异步迭代器和异步生成器</h3> <p>在了解异步迭代器和异步生成器之前，先来了解下什么是迭代器和生成器。</p> <ul><li><strong>迭代器 Iterator</strong></li></ul> <p>Iterator 是一个特殊对象，它包含一个 <code>next</code> 方法，next 方法返回一个对象，这个对象包含两个属性，一个是 value；一个是 done，done是一个布尔值，表示是否遍历完成。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> done<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下面的例子演示如何创建并使用一个迭代器。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">createIterator</span> <span class="token operator">=</span> <span class="token parameter">items</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
  <span class="token keyword">const</span> len <span class="token operator">=</span> keys<span class="token punctuation">.</span>length
  <span class="token keyword">let</span> pointer <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> done <span class="token operator">=</span> pointer <span class="token operator">&gt;=</span> len
      <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token operator">!</span>done <span class="token operator">?</span> items<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>pointer<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">undefined</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">,</span>
        done
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> it1 <span class="token operator">=</span> <span class="token function">createIterator</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {value: 1, done: false}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {value: 2, done: false}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {value: 3, done: false}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {value: undefined, done: true}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>拥有 iterator 的数据结构，也就是具有 <code>Symbol.iterator</code> 方法的数据结构，是可以被 for...of 遍历的。</p> <p>数组原生就具有 iterator 接口。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> arr<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// function，证明数据具有这个方法</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> val <span class="token keyword">of</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token comment">// 1 2 3</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>对象默认是没有 iterator 接口的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token string">'c'</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> obj<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 'undefined'，证明没有这个方法</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> val <span class="token keyword">of</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token comment">// Uncaught TypeError: obj is not iterable</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>但是可以手动给对象部署 iterator 接口。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token string">'c'</span><span class="token punctuation">}</span>

obj<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 给对象部署 iterator 接口</span>
  <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
  <span class="token keyword">const</span> len <span class="token operator">=</span> keys<span class="token punctuation">.</span>length
  <span class="token keyword">let</span> pointer <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> done <span class="token operator">=</span> pointer <span class="token operator">&gt;=</span> len
      <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token operator">!</span>done <span class="token operator">?</span> self<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>pointer<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">undefined</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">,</span>
        done
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> obj<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// function</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> val <span class="token keyword">of</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token comment">// a b c</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ul><li><strong>生成器 Generator</strong></li></ul> <p>Generator 是一个特殊函数，函数体内部使用 <code>yeild</code> 表达式，定义不同的内部状态，<strong>当执行Generator函数时，不会直接执行函数体，而是会返回一个遍历器对象（iterator）</strong>。</p> <p>function 关键字和函数名之间有一个 <code>*</code> 。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'正常函数中我会执行'</span><span class="token punctuation">)</span>
  <span class="token keyword">yield</span> <span class="token number">1</span>
  <span class="token keyword">yield</span> <span class="token number">2</span>
  <span class="token keyword">yield</span> <span class="token number">3</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行完了'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> iteratorFn <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 这时函数体并没有被执行，没有任何输出，而是创建了一个iterator</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iteratorFn<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 当调用 next 方法之后函数体才会开始执行</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iteratorFn<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iteratorFn<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iteratorFn<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>执行结果如下。</p> <p><img src="data:image/png;base64,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" alt="ES9" title="ES9"></p> <ul><li><strong>异步迭代器 Async Iterator</strong></li></ul> <p>异步迭代器和同步迭代器相同，都是一个特殊对象，并且含有一个 next 方法，区别在于同步迭代器的 next 方法返回一个含有 value 和 done 属性的对象，而异步迭代器的 next 方法返回一个 Promise 对象，并且 Promise 对象的值为含有 value 和 done 属性的对象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> done<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> done<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>下面演示了如何模拟创建并使用一个异步迭代器，并不是一个真正的异步迭代器。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">createAsyncIterator</span> <span class="token operator">=</span> <span class="token parameter">items</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
  <span class="token keyword">const</span> len <span class="token operator">=</span> keys<span class="token punctuation">.</span>length
  <span class="token keyword">let</span> pointer <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> done <span class="token operator">=</span> pointer <span class="token operator">&gt;=</span> len
      <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token operator">!</span>done <span class="token operator">?</span> items<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>pointer<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">undefined</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        value<span class="token punctuation">,</span>
        done
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> asyncIterator <span class="token operator">=</span> <span class="token function">createAsyncIterator</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
aynscIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// {value: 1, done: false}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
aynscIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// {value: 2, done: false}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
aynscIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// {value: 3, done: false}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
aynscIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// {value: undefined, done: true}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ul><li><strong>异步执行语句 for await...of</strong></li></ul> <p>for...of 方法能够遍历具有 Symbol.iterator 接口的同步迭代器数据，但是不能遍历异步迭代器。 ES9新增的 for await...of 可以用来遍历具有 Symbol.asyncIterator 方法的数据结构，也就是异步迭代器，且会等待前一个成员的状态改变后才会遍历到下一个成员，相当于 async 函数内部的 await。</p> <p>定义一个真正的异步迭代器，并使用 for await...of 遍历它。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> asyncItems <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>asyncIterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">const</span> len <span class="token operator">=</span> keys<span class="token punctuation">.</span>length
    <span class="token keyword">let</span> pointer <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> done <span class="token operator">=</span> pointer <span class="token operator">&gt;=</span> len
        <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token operator">!</span>done <span class="token operator">?</span> self<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>pointer<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>value<span class="token punctuation">,</span> done<span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> val <span class="token keyword">of</span> asyncItems<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 等待1s后打印出1，再过1s后打印出2，再过1s后打印出3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><ul><li><strong>异步生成器 Async Generator</strong></li></ul> <p>我们可以采取一种更方便的方式创建异步迭代器，就是利用异步生成器。</p> <p>异步生成器和普通的生成器很像，但是它是 async 函数，内部可以使用 await 表达式，并且它返回一个具有 Symbol.asyncIterator 方法的对象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">yield</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">yield</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> asyncFn <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> val <span class="token keyword">of</span> asyncFn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token comment">// 1 2 3</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> asyncFn<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>asyncIterator<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 'function'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="promise-finally"><a href="#promise-finally" class="header-anchor">#</a> Promise.finally</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/finally" target="_blank" rel="noopener noreferrer">Promise.prototype.finally()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 返回一个 Promise。在 promise 结束时，无论结果是 fulfilled 或者是 rejected，都会执行指定的回调函数。这为在 Promise 是否成功完成后都需要执行的代码提供了一种方式，避免了同样的语句需要在 then() 和 catch() 中各写一次的情况。</p> <p>比如下面的代码只会执行 resolve 里的内容，如果把 resolve 注释掉，才会执行 reject 里的内容。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'fail'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>无论是成功还是失败，我们都想执行代码，这个时候就需要用到 finally 了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'fail'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'不论成功或失败我都会执行'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="rest-spread"><a href="#rest-spread" class="header-anchor">#</a> Rest/Spread</h3> <p>这个就是我们通常所说的<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Rest_parameters" target="_blank" rel="noopener noreferrer">剩余参数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Spread_syntax" target="_blank" rel="noopener noreferrer">扩展运算符<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，两者的符号都是 <code>...</code> ，这在 ES6 中就已经引入了，但是 ES6 中的作用对象<strong>仅限于数组和函数调用</strong>。在 ES9 中，为<strong>对象</strong>提供了像数组一样的剩余参数和扩展运算符。</p> <ul><li>剩余参数的使用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">...</span>c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// 1 2 [3, 4, 5] </span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;shenzhen&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  info<span class="token operator">:</span> <span class="token punctuation">{</span>
    phone<span class="token operator">:</span> <span class="token number">188888</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name<span class="token punctuation">,</span> <span class="token operator">...</span>infos <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> infos<span class="token punctuation">)</span> <span class="token comment">// shenzhen {age: 4, info: {…}}</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>在数组中使用扩展运算符</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token operator">...</span>arr<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [11, 22, 1, 2, 3]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>在对象中使用扩展运算符，解构</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;shenzhen&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  info<span class="token operator">:</span> <span class="token punctuation">{</span>
    phone<span class="token operator">:</span> <span class="token number">188888</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> <span class="token operator">...</span>infos <span class="token punctuation">}</span> <span class="token operator">=</span> obj
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> infos<span class="token punctuation">)</span> <span class="token comment">// shenzhen {age: 4, info: {…}}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>拷贝对象并增加新属性，类似对象合并</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;shenzhen&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  info<span class="token operator">:</span> <span class="token punctuation">{</span>
    phone<span class="token operator">:</span> <span class="token number">188888</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>obj<span class="token punctuation">,</span> address<span class="token operator">:</span> <span class="token string">&quot;beijing&quot;</span> <span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span> <span class="token comment">// {name: &quot;shenzhen&quot;, age: 4, info: {…}, address: &quot;beijing&quot;}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>实现对象浅拷贝</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;shenzhen&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  info<span class="token operator">:</span> <span class="token punctuation">{</span>
    phone<span class="token operator">:</span> <span class="token number">188888</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> objClone <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>obj <span class="token punctuation">}</span>
objClone<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'guangzhou'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>objClone<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// guangzhou </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// shenzhen 原来的数据不受影响，实现浅拷贝</span>
objClone<span class="token punctuation">.</span>info<span class="token punctuation">.</span>phone <span class="token operator">=</span> <span class="token number">177777</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>objClone<span class="token punctuation">.</span>info<span class="token punctuation">.</span>phone<span class="token punctuation">)</span> <span class="token comment">// 177777</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>info<span class="token punctuation">.</span>phone<span class="token punctuation">)</span> <span class="token comment">// 177777</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="对正则表达式增强"><a href="#对正则表达式增强" class="header-anchor">#</a> 对正则表达式增强</h3> <ul><li><code>?&lt;name&gt;</code> —— 命名捕获组</li></ul> <p>关于命名捕获组的说明可以参考这篇文章：<a href="https://esnext.justjavac.com/proposal/regexp-named-groups.html" target="_blank" rel="noopener noreferrer">命名捕获组<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>假如有一个需求：将 YYYY-MM-DD 格式的年月日解析到数组中</p> <p>ES9 之前的实现方法可能如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> dateStr <span class="token operator">=</span> <span class="token string">'2020-05-28'</span>
<span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/([0-9]{4})-([0-9]{2})-([0-9]{2})/</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>dateStr<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ES9 提供了 <code>?&lt;name&gt;</code> 的形式可以为捕获的分组自定义名称。上面可改成：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> dateStr <span class="token operator">=</span> <span class="token string">'2020-05-28'</span>
<span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/(?&lt;year&gt;[0-9]{4})-(?&lt;month&gt;[0-9]{2})-(?&lt;day&gt;[0-9]{2})/</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>dateStr<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>groups<span class="token punctuation">.</span>year<span class="token punctuation">,</span> res<span class="token punctuation">.</span>groups<span class="token punctuation">.</span>month<span class="token punctuation">,</span> res<span class="token punctuation">.</span>groups<span class="token punctuation">.</span>day<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>假如现在有另外一个需求：要将时间改成月日年的格式。可以通过自定义命名捕获分组配合 replace 来实现。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> dateStr <span class="token operator">=</span> <span class="token string">'2020-05-28'</span>
<span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/(?&lt;year&gt;[0-9]{4})-(?&lt;month&gt;[0-9]{2})-(?&lt;day&gt;[0-9]{2})/</span>
<span class="token keyword">const</span> newDate <span class="token operator">=</span> dateStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$&lt;month&gt;-$&lt;day&gt;-$&lt;year&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newDate<span class="token punctuation">)</span> <span class="token comment">// 05-28-2020</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><strong>反向断言（后行断言）</strong></li></ul> <p>假如有这样一个需求：需要捕获货币符号</p> <p>通过先行断言的方式实现如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'$123'</span>
<span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/\D(?=\d+)/</span> <span class="token comment">// 先行断言格式的正则表达式 ?=pattern</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// $</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>通过后行断言（反向断言）的方式获取数字的实现如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'$123'</span>
<span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/(?&lt;=\D)\d+/</span> <span class="token comment">// 后行断言格式的正则表达式 ?&lt;=pattern</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 123</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><strong>增加 s/dotAll 模式</strong></li></ul> <p>在 JavaScript 正则表达式中，<code>.</code> 可以用来匹配单个字符，但是有两种字符匹配不到：多字节 emoji 字符和行终结符（比如换行\n、回车\r等等）。</p> <p>在 ES9 中，新增了一个标志 <code>s</code> 用来表示 dotAll，以使 <code>.</code> 能够匹配任意单个字符。具体说明可参考这篇文章：<a href="https://esnext.justjavac.com/proposal/regexp-dotall-flag.html" target="_blank" rel="noopener noreferrer">s/dotAll 模式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'shen\nzhen'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex">/shen.zhen/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex">/shen.zhen/s</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><strong>汉字匹配</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> oldReg <span class="token operator">=</span> <span class="token regex">/[\u4e00-\u9fa5]/</span>  <span class="token comment">// ES9 之前的书写方式，既繁琐又不好记</span>
<span class="token keyword">const</span> newReg <span class="token operator">=</span> <span class="token regex">/\p{Script=Han}/u</span>  <span class="token comment">// ES9 的书写方式，更加容易理解</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'深圳'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>oldReg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newReg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><strong>非转义序列的模板字符串</strong></li></ul> <p>具体说明可参考这篇文章：<a href="https://esnext.justjavac.com/proposal/template-literal-revision.html" target="_blank" rel="noopener noreferrer">非转义序列的模板字符串<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/raw" target="_blank" rel="noopener noreferrer">String.raw()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个模板字符串的标签函数，用来获取一个模板字符串的原始字符串，这是 ES6 提供的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'\u{54}'</span> <span class="token comment">// 'T'</span>
String<span class="token punctuation">.</span>raw<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\u{54}</span><span class="token template-punctuation string">`</span></span> <span class="token comment">// '\u{54}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="es10-新特性"><a href="#es10-新特性" class="header-anchor">#</a> ES10 新特性</h2> <h3 id="flat-和-flatmap"><a href="#flat-和-flatmap" class="header-anchor">#</a> flat() 和 flatMap()</h3> <p>（1）flat</p> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/flat" target="_blank" rel="noopener noreferrer">flat()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法可以用来扁平化一个嵌套数组，默认只能扁平化 1 层深度，可以传一个参数指定需要扁平化的深度层数。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// [1, 2, 3, 4, 5]</span>

<span class="token keyword">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 2, 3, 4, 5, [6, 7]]</span>

<span class="token comment">// 指定 2 层深度</span>
<span class="token keyword">const</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr2<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 2, 3, 4, 5, 6, 7]</span>

<span class="token comment">// 指定任意深度</span>
<span class="token keyword">const</span> arr3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr3<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>flat() 还可以用来去除数组中的空项。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 2, 3]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>（2）flatMap</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/flatMap" target="_blank" rel="noopener noreferrer">flatMap()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法首先使用映射函数映射每个元素，然后将结果压缩成一个新数组。它与 map 连着深度值为 1 的 flat 几乎相同，但 flatMap 通常在合并成一种方法的效率稍微高一些。默认也是只能扁平化 1 层深度。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [[2], [4], [6], [8]]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [2, 4, 6, 8]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [[2], [4], [6], [8]]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="object-fromentries"><a href="#object-fromentries" class="header-anchor">#</a> Object.fromEntries()</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/fromEntries" target="_blank" rel="noopener noreferrer">Object.fromEntries()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法能够将一个键值对列表转换成一个对象。是 <code>Object.entries()</code> 的反转。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Map 转换为 Object</span>
<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'first'</span><span class="token punctuation">,</span> <span class="token string">'shenzhen'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'second'</span><span class="token punctuation">,</span> <span class="token string">'guangzhou'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {first: &quot;shenzhen&quot;, second: &quot;guangzhou&quot;}</span>

<span class="token comment">// Array 转换为 Object</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span><span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {0: &quot;a&quot;, 1: &quot;b&quot;, 2: &quot;c&quot;}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="string-prototype-matchall"><a href="#string-prototype-matchall" class="header-anchor">#</a> String.prototype.matchAll()</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/matchAll" target="_blank" rel="noopener noreferrer">String.prototype.matchAll()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法返回一个包含所有匹配正则表达式的结果及分组捕获组的迭代器。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'guangzhou shenzhen shenzhen'</span>
<span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/shen*/g</span>

<span class="token comment">// matchAll 之前的做法</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>matches <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>matches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-start=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>matches<span class="token punctuation">.</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-end=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reg<span class="token punctuation">.</span>lastIndex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
  shen-start=10-end=14
  shen-start=19-end=23
*/</span>

<span class="token comment">// 使用 matchAll 的做法</span>
<span class="token keyword">let</span> matches1 <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>matches1<span class="token punctuation">)</span> <span class="token comment">// 返回一个迭代器：RegExpStringIterator {}</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> match1 <span class="token keyword">of</span> matches1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-start=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match1<span class="token punctuation">.</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-end=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match1<span class="token punctuation">.</span>index <span class="token operator">+</span> match1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
  shen-start=10-end=14
  shen-start=19-end=23
*/</span>

<span class="token comment">// 由于 matchAll 返回的是一个迭代器，所以也可以调用 next 方法</span>
<span class="token keyword">let</span> matches1 <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>matches1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {value: Array(1), done: false}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>matches1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {value: Array(1), done: false}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>matches1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {value: undefined, done: true}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>matchAll 还可以用于更好的捕获分组。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 使用 match 时并没有捕获分组</span>
<span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/s(h)en(zhen(\d?))/g</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">&quot;shenzhen66shenzhen66&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [&quot;shenzhen6&quot;, &quot;shenzhen6&quot;]</span>

<span class="token comment">// 使用 matchAll 就会捕获分组</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>str<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [&quot;shenzhen6&quot;, &quot;h&quot;, &quot;zhen6&quot;, &quot;6&quot;, index: 0, input: &quot;shenzhen66shenzhen66&quot;, groups: undefined]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [&quot;shenzhen6&quot;, &quot;h&quot;, &quot;zhen6&quot;, &quot;6&quot;, index: 10, input: &quot;shenzhen66shenzhen66&quot;, groups: undefined]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="string-prototype-trimstart-和-string-prototype-trimend"><a href="#string-prototype-trimstart-和-string-prototype-trimend" class="header-anchor">#</a> String.prototype.trimStart() 和 String.prototype.trimEnd()</h3> <p>这两个方法的作用是去除字符串的首位空格。</p> <h3 id="string-prototype-description"><a href="#string-prototype-description" class="header-anchor">#</a> String.prototype.description</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 通过工厂函数 Symbol() 创建符号时，可以选择通过参数提供字符串作为描述</span>
<span class="token keyword">const</span> sym <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'description'</span><span class="token punctuation">)</span>

<span class="token comment">// 之前获取描述的唯一方法是将符号转换为字符串</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>sym<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Symbol(description)</span>

<span class="token comment">// 现在可以通过 Symbol.prototype.description 直接获取</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sym<span class="token punctuation">.</span>description<span class="token punctuation">)</span> <span class="token comment">// description</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="省略-catch-参数"><a href="#省略-catch-参数" class="header-anchor">#</a> 省略 catch 参数</h3> <p>在 ES10 之前，我们必须通过语法为 catch 子句绑定异常变量，无论是否有必要。很多时候 catch 块是多余的。 ES10 提案使我们能够简单的把变量省略掉。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ES10 之前</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 现在</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="行分隔符（u-2028）和段分隔符（u-2029）符号现在允许在字符串文字中，与-json-匹配"><a href="#行分隔符（u-2028）和段分隔符（u-2029）符号现在允许在字符串文字中，与-json-匹配" class="header-anchor">#</a> 行分隔符（U + 2028）和段分隔符（U + 2029）符号现在允许在字符串文字中，与 JSON 匹配</h3> <p>JSON 可以包含行分隔符和段分隔符。但是目前只是草案，浏览器还未支持。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token string">'{&quot;name&quot;:&quot;shenzhen\nguangzhou&quot;}'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token comment">// {&quot;name&quot;:&quot;shenzhen</span>
                   <span class="token comment">// guangzhou&quot;}</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token comment">// Uncaught SyntaxError: Unexpected token in JSON at position 17</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="更加友好的-json-stringify"><a href="#更加友好的-json-stringify" class="header-anchor">#</a> 更加友好的 JSON.stringify</h3> <p>如果输入 Unicode 格式但是超出范围的字符，在原先JSON.stringify返回格式错误的Unicode字符串。现在实现了一个改变JSON.stringify的第3阶段提案，因此它为其输出转义序列，使其成为有效Unicode（并以UTF-8表示）。
对字符 U+D800 到 U+DFFF 处理。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&quot;\UDEAD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// JSON转义序列，应该输出'&quot;\\UDEAD&quot;'，但是现在浏览器还未支持，输出的是&quot;UDEAD&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="function-prototype-tostring"><a href="#function-prototype-tostring" class="header-anchor">#</a> Function.prototype.toString()</h3> <p>现在能够返回精确字符，包括空格和注释。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token comment">/*注释*/</span> foo <span class="token comment">/*注释*/</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 之前</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// function foo(){}</span>
<span class="token comment">// 现在</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// function /*注释*/ foo /*注释*/() {}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="bigint-任意精度整数"><a href="#bigint-任意精度整数" class="header-anchor">#</a> BigInt —— 任意精度整数</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt" target="_blank" rel="noopener noreferrer">BigInt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一种内置对象，它提供了一种方法来表示大于 <code>2^53 - 1</code> 的整数。这原本是 Javascript中可以用 Number 表示的最大数字。BigInt 可以表示任意大的整数。</p> <p>现在的基本数据类型就有 7 种：String、Number、Boolean、Null、Undefined、Symbol、BigInt。</p> <p>之前 js 中能表示的整数的最大值为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span><span class="token punctuation">)</span> <span class="token comment">// 9007199254740991</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但是现在有了 BigInt 之后，就不受这个限制了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建 BigInt 类型数据的方式</span>
<span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">1n</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'类型为：'</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> num<span class="token punctuation">)</span> <span class="token comment">// 类型为： bigint</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token comment">// 另一种创建 BigInt 类型数据的方式</span>
<span class="token keyword">const</span> bigInt <span class="token operator">=</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bigInt<span class="token punctuation">)</span> <span class="token comment">// 10n</span>

<span class="token comment">// 只能和同类型的数据进行运算</span>
<span class="token keyword">let</span> num1 <span class="token operator">=</span> <span class="token number">10n</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num <span class="token operator">-</span> num1<span class="token punctuation">)</span> <span class="token comment">// -9n</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// Uncaught TypeError: Cannot mix BigInt and other types, use explicit conversions</span>

<span class="token comment">// 使用 Object 包装后， BigInt 被认为是一个普通 &quot;object&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token number">1n</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="标准化-globalthis-对象"><a href="#标准化-globalthis-对象" class="header-anchor">#</a> 标准化 globalThis 对象</h3> <p>可以在任何平台访问全局属性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getGlobal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> self <span class="token operator">!=</span> <span class="token string">&quot;unefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> self
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!=</span> <span class="token string">&quot;unefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> window
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> global <span class="token operator">!=</span> <span class="token string">&quot;unefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> global
  <span class="token punctuation">}</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalThis<span class="token punctuation">)</span> <span class="token comment">// 谷歌浏览器中打印出来是一个 window 对象，但是在 node 中还未支持这个对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>题外话：Array.prototype.sort() 和 TimSort()</p> <p>Array.prototype.sort 是现有的浏览器排序方式，但是是不稳定的排序，最坏的时间复杂度可为 O(n^2)；新的 v8 引擎实现了一个新的 TimSort() 方法，这是稳定的排序，时间复杂度为 O(nlogn)，可以阅读 V8 源码学习。这点也需要了解下。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// </span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;shenzhen&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;www&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>age <span class="token operator">-</span> b<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token comment">// 由于在谷歌浏览器中已经使用了新的排序引擎 TimSort，所以结果是稳定排序</span>

<span class="token comment">// 非稳定的排序，因为 shenzhen 和 www 的 age 都是 4，但是排序后两者的位置换了</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;www&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;shenzhen&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">// 稳定的排序，shenzhen 和 www 两者的位置没有变化</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;shenzhen&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;www&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javascript/jsUnknow1.html" class="prev">
        你不知道的JavaScript（上）
      </a></span> <span class="next"><a href="/javascript/promise.html">
        手写Promise
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.83f3402d.js" defer></script><script src="/assets/js/2.a0a69aa9.js" defer></script><script src="/assets/js/36.a4d7a3e2.js" defer></script>
  </body>
</html>
