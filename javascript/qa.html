<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>什么是QA工程师 | 鸵鸟蛋的个人主页</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/image/logo.jpg">
    <meta name="description" content="鸵鸟蛋的世界">
    <link rel="preload" href="/assets/css/0.styles.22095322.css" as="style"><link rel="preload" href="/assets/js/app.83f3402d.js" as="script"><link rel="preload" href="/assets/js/2.a0a69aa9.js" as="script"><link rel="preload" href="/assets/js/3.8959ecef.js" as="script"><link rel="prefetch" href="/assets/js/10.439f342d.js"><link rel="prefetch" href="/assets/js/11.216a07f2.js"><link rel="prefetch" href="/assets/js/12.a66aca6c.js"><link rel="prefetch" href="/assets/js/13.f5f24ce3.js"><link rel="prefetch" href="/assets/js/14.32d895c9.js"><link rel="prefetch" href="/assets/js/15.623a8373.js"><link rel="prefetch" href="/assets/js/16.31912b5c.js"><link rel="prefetch" href="/assets/js/17.68031807.js"><link rel="prefetch" href="/assets/js/18.a66b9dd4.js"><link rel="prefetch" href="/assets/js/19.c3c1ad4e.js"><link rel="prefetch" href="/assets/js/20.67c9540c.js"><link rel="prefetch" href="/assets/js/21.722fe9fe.js"><link rel="prefetch" href="/assets/js/22.72f8f629.js"><link rel="prefetch" href="/assets/js/23.f730e8f1.js"><link rel="prefetch" href="/assets/js/24.9e67058b.js"><link rel="prefetch" href="/assets/js/25.81a3aeea.js"><link rel="prefetch" href="/assets/js/26.18ba7257.js"><link rel="prefetch" href="/assets/js/27.eee6c364.js"><link rel="prefetch" href="/assets/js/28.d2732972.js"><link rel="prefetch" href="/assets/js/29.d54fb216.js"><link rel="prefetch" href="/assets/js/30.e71f561f.js"><link rel="prefetch" href="/assets/js/31.4f56f5c3.js"><link rel="prefetch" href="/assets/js/32.4ecd4417.js"><link rel="prefetch" href="/assets/js/33.32d721bd.js"><link rel="prefetch" href="/assets/js/34.ab789bed.js"><link rel="prefetch" href="/assets/js/35.e2330e74.js"><link rel="prefetch" href="/assets/js/36.a4d7a3e2.js"><link rel="prefetch" href="/assets/js/37.ca9e6d12.js"><link rel="prefetch" href="/assets/js/38.8e7d9dae.js"><link rel="prefetch" href="/assets/js/39.818446de.js"><link rel="prefetch" href="/assets/js/4.bc08363f.js"><link rel="prefetch" href="/assets/js/40.6e5412c0.js"><link rel="prefetch" href="/assets/js/41.c046cc2c.js"><link rel="prefetch" href="/assets/js/42.3a98e5b0.js"><link rel="prefetch" href="/assets/js/43.c48084fd.js"><link rel="prefetch" href="/assets/js/44.9a68e6e8.js"><link rel="prefetch" href="/assets/js/45.607f9d7b.js"><link rel="prefetch" href="/assets/js/46.4fbd5727.js"><link rel="prefetch" href="/assets/js/47.ff6cd126.js"><link rel="prefetch" href="/assets/js/48.4e44b645.js"><link rel="prefetch" href="/assets/js/49.b3559737.js"><link rel="prefetch" href="/assets/js/5.247f2124.js"><link rel="prefetch" href="/assets/js/50.4c05ad25.js"><link rel="prefetch" href="/assets/js/51.27325a7b.js"><link rel="prefetch" href="/assets/js/52.62b7f674.js"><link rel="prefetch" href="/assets/js/53.fe6c2e96.js"><link rel="prefetch" href="/assets/js/54.68c91b01.js"><link rel="prefetch" href="/assets/js/55.a4e116a4.js"><link rel="prefetch" href="/assets/js/56.adec72d4.js"><link rel="prefetch" href="/assets/js/57.c8755c55.js"><link rel="prefetch" href="/assets/js/58.99e5de2f.js"><link rel="prefetch" href="/assets/js/59.f7deea0d.js"><link rel="prefetch" href="/assets/js/6.9cd44cad.js"><link rel="prefetch" href="/assets/js/60.608e9336.js"><link rel="prefetch" href="/assets/js/7.d1cbdc31.js"><link rel="prefetch" href="/assets/js/8.3e9a3d41.js"><link rel="prefetch" href="/assets/js/9.698ca62a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.22095322.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">鸵鸟蛋的个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://starcoderln.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/StarCoderLn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://starcoderln.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/StarCoderLn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VuePress</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>函数式编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面向切面编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javascript/jsUnknow1.html" class="sidebar-link">你不知道的JavaScript（上）</a></li><li><a href="/javascript/ecmascript.html" class="sidebar-link">ECMAScript</a></li><li><a href="/javascript/promise.html" class="sidebar-link">手写Promise</a></li><li><a href="/javascript/eventloop.html" class="sidebar-link">Event loop 总结</a></li><li><a href="/javascript/jsUtils.html" class="sidebar-link">JavaScript常用工具方法</a></li><li><a href="/javascript/qa.html" class="active sidebar-link">JavaScript与QA工程师</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/qa.html#什么是qa工程师" class="sidebar-link">什么是QA工程师</a></li><li class="sidebar-sub-header"><a href="/javascript/qa.html#测试核心概念" class="sidebar-link">测试核心概念</a></li><li class="sidebar-sub-header"><a href="/javascript/qa.html#自动化测试实战" class="sidebar-link">自动化测试实战</a></li><li class="sidebar-sub-header"><a href="/javascript/qa.html#e2e-测试实战" class="sidebar-link">e2e 测试实战</a></li><li class="sidebar-sub-header"><a href="/javascript/qa.html#接口测试实战" class="sidebar-link">接口测试实战</a></li></ul></li><li><a href="/javascript/jsTest.html" class="sidebar-link">JavaScript基础测试</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端监控</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法学习总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac 开发体验优化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="什么是qa工程师"><a href="#什么是qa工程师" class="header-anchor">#</a> 什么是QA工程师</h2> <p>QA（Quality Assurance）是质量保证的意思。但实际上好像每家公司对 QA 的定义和岗位职责不太一样，具体可以参考下知乎上的这篇文章：<a href="https://www.zhihu.com/question/19685881" target="_blank" rel="noopener noreferrer">QA这个职位主要做什么？重要么？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="测试核心概念"><a href="#测试核心概念" class="header-anchor">#</a> 测试核心概念</h2> <p><img src="/assets/img/qa1.9fb3af28.png" alt="QA" title="QA"></p> <p><strong>1. 单元测试</strong></p> <ul><li><p>目的：单元测试能够让开发明确知道代码结果。</p></li> <li><p>原则：<strong>单一职责</strong>、<strong>接口抽象</strong>、<strong>层次分离</strong>。</p></li> <li><p>断言库：保证最小单元是否正常运行的检测方法。</p></li> <li><p>测试风格：</p> <p><strong>测试驱动开发</strong>（Test-Driven Development，<code>TDD</code>）、<strong>行为驱动开发</strong>（Behavior Driven Development，<code>BDD</code>）均是<strong>敏捷开发</strong>方法论。</p> <p><strong>TDD 关注所有的功能是否被实现（每一个功能都必须有对应的测试用例）</strong>，suite 配合 test 利用 assert('tobi' == user.name)。简单来说就是先写测试用例，再干活。</p> <p><strong>BDD 关注整体行为是否符合整体预期，编写的每一行代码都有目的提供一个全面的测试用例集</strong>。expect/should，describe 配合 it 利用自然语言 expect(1).toEqual(fn()) 执行结果。简单来说就是先干活再写测试用例，国内大部分公司都是采用这种方式。</p></li> <li><p><strong>单元测试框架</strong></p> <p><a href="https://github.com/tj/better-assert" target="_blank" rel="noopener noreferrer">better-assert<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（TDD 断言库，Github 276star 21fork）</p> <p><a href="https://github.com/tj/should.js" target="_blank" rel="noopener noreferrer">should.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（BDD 断言库，Github 2761star 211fork）</p> <p><a href="https://github.com/Automattic/expect.js" target="_blank" rel="noopener noreferrer">expect.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（BDD 断言库，Github 2057star 209fork）</p> <p><a href="https://github.com/chaijs/chai" target="_blank" rel="noopener noreferrer">chai.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（TDD BDD 双模，Github 6826star 622fork）</p> <p><a href="https://github.com/jasmine/jasmine" target="_blank" rel="noopener noreferrer">Jasmine.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（BDD，Github 14808star 2.2kfork）</p> <p>Node.js 本身集成 require('assert');</p> <p><a href="https://github.com/theintern/intern" target="_blank" rel="noopener noreferrer">Intern<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 更是一个大而全的单元测试框架。</p> <p><a href="https://github.com/qunitjs/qunit" target="_blank" rel="noopener noreferrer">QUnit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一个游离在 jQuery 左右的测试框架。</p> <p><a href="https://github.com/alibaba/macaca/blob/master/README.zh.md" target="_blank" rel="noopener noreferrer">Macaca<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一套完整的自动化测试解决方案，国内神器，来自阿里巴巴。</p></li> <li><p><strong>单元测试运行流程</strong></p> <p>（1）before 单个测试用例(it)开始前。</p> <p>（2）beforeEach 每一个测试用例开始前。</p> <p>（3）it 定义测试用例，并利用断言库进行，设置 chai 如：expect(x).to.equal(true); 异步 mocha。</p> <p>（4）以上专业术语叫 mock。</p></li></ul> <p><img src="/assets/img/qa2.294f6624.png" alt="QA" title="QA"></p> <ul><li><p><strong>自动化单元测试</strong></p> <p>karma 自动化 runner 集成 PhantomJS 无刷新</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install <span class="token operator">-</span>g karma

npm install karma<span class="token operator">-</span>cli <span class="token operator">--</span>save<span class="token operator">-</span>dev

npm install karma<span class="token operator">-</span>chrome<span class="token operator">-</span>launcher <span class="token operator">--</span>save<span class="token operator">-</span>dev

npm install karma<span class="token operator">-</span>phantomjs<span class="token operator">-</span>launcher <span class="token operator">--</span>save<span class="token operator">-</span>dev

npm install karma<span class="token operator">-</span>mocha <span class="token operator">--</span>save<span class="token operator">-</span>dev

npm install karma<span class="token operator">-</span>chai <span class="token operator">--</span>save<span class="token operator">-</span>dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><strong>报告和单测覆盖率检查</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install karma<span class="token operator">-</span>coverage <span class="token operator">--</span>save<span class="token operator">-</span>dev

<span class="token comment">// 配置代码覆盖测试率生成结果</span>
coverageReporter<span class="token operator">:</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'html'</span><span class="token punctuation">,</span>
  dir<span class="token operator">:</span> <span class="token string">'coverage/'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>2. 性能测试</strong></p> <ul><li><p><strong>基准测试</strong></p> <p>面向切面编程 AOP 无侵入式统计。</p> <p>Benchmark 基准测试方法，它并不是简单地统计执行多少次测试代码后对比时间，它对测试有着<strong>严密的抽样过程</strong>。执行多少次取决于采样到的数据能否完成统计。根据统计次数计算方差。</p></li> <li><p><strong>压力测试</strong></p> <p>对网络接口做压力测试需要检查的几个常用指标有<code>吞吐率</code>、<code>响应时间</code>和<code>并发数</code>，这些指标反映了服务器并发处理能力。</p> <p>PV 网站<strong>当日访问人数</strong>，UV <strong>独立访问人数</strong>。PV 每天几十万甚至上百万就需要考虑压力测试。换算公式：<code>QPS = PV / t</code>。PS：1000000 / 10 * 60 * 60 = 27.7（100万请求集中在10小时，服务器每秒处理27.7个业务请求）。</p> <p>常用的压力测试工具有：ab、siege、http_load。</p> <p>ab -c 100 -n 100 http:localhost:8081 每秒持续发出28个请求</p> <p>Request per second 表示服务器每秒处理请求数，即为 <code>QPS</code>;</p> <p>Failed requests 表示此次请求失败的请求数；</p> <p>Connection Times 连接时间，它包括客户端向服务器端建立连接、服务器端处理请求、等待报文响应的过程。</p></li></ul> <p><strong>3. 安全测试</strong></p> <ul><li><p><strong>安全漏洞检查</strong></p> <p>XSS</p> <p>SQL</p> <p>CSRF</p></li></ul> <p><strong>4. 功能测试</strong></p> <ul><li><p><strong>用户真实性检查</strong></p> <p><a href="https://wizardforcel.gitbooks.io/selenium-doc/content/official-site/selenium-web-driver.html" target="_blank" rel="noopener noreferrer">selenium-webdriver<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/angular/protractor" target="_blank" rel="noopener noreferrer">protractor<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/vvo/selenium-standalone" target="_blank" rel="noopener noreferrer">selenium-standalone<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://webdriver.io" target="_blank" rel="noopener noreferrer">WebdriverIO<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>冒烟测试 SmokeTest 是自由测试的一种，找到一个 BUG 开发修复，然后专门针对此 BUG，优点是节省生煎防止 build 失败，缺点是覆盖率极低。</p> <p>回归测试是修改一处对整体功能全部测试，一般配合自动化测试。</p></li></ul> <p><strong>5. JsLint &amp; JsHint</strong></p> <ul><li><p>目的：检测 JavaScript 代码标准。</p></li> <li><p>原因：JavaScript 代码诡异，保证团队代码规范。</p></li> <li><p><a href="http://www.jslint.com/" target="_blank" rel="noopener noreferrer">lint<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="http://www.jshint.com/" target="_blank" rel="noopener noreferrer">hint<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>搭配自动化管理工具完善自动化测试 gtunt-jslint、grunt-jshint。</p></li></ul> <h2 id="自动化测试实战"><a href="#自动化测试实战" class="header-anchor">#</a> 自动化测试实战</h2> <ol><li>一般测试用例文件都是以 .test.js、.spec.js 后缀命名的，也有的直接写成 indexSpec.js。并且测试用例文件和它对应的 js 文件名字也是一一对应的，比如 index.spec.js 就是 index.js 这个文件的测试用例文件。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
window<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.spec.js</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'函数基本测试用例'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'+1测试函数'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li><p>执行 npm init -y 初始化 package.json 文件。</p></li> <li><p>安装 <a href="http://karma-runner.github.io/5.0/intro/installation.html" target="_blank" rel="noopener noreferrer">karma<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ol> <p>安装方式首选 npm：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install karma --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果 npm 实在太慢可以用 yarn，会比 npm 快一点：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>yarn add karma
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>用 npm 安装的话会生成 package-lock.json 文件，用 yarn 安装的话会生成 yarn.lock 文件。</p> <p>如果想全局安装 karma，还是需要先执行以上命名在本地安装好 karma，然后再执行以下命令安装 karma-cli (mac 系统下要加 sudo，不然没权限)：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo npm install -g karma-cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者用 yarn：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>yarn add global karma-cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>全局安装完成后，就可以使用以下命令在本地配置 karma 的环境，这样就不需要在 package.json 手动添加命令了。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>karma init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/karma1.386976ec.png" alt="karma" title="karma"></p> <p>配置完之后就可以在本地看到一个 karma.conf.js 文件了。这个文件需要重视，因为它就是 karma 的配置文件。</p> <p><img src="/assets/img/karma2.3c96336c.png" alt="karma" title="karma"></p> <p><img src="/assets/img/karma3.b09a1e11.png" alt="karma" title="karma"></p> <ol start="4"><li>在 package.json 的 scripts 中添加命令</li></ol> <div class="language-json line-numbers-mode"><pre class="language-json"><code>scripts<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;init&quot;</span><span class="token operator">:</span> <span class="token string">&quot;karma init&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果是全局安装了 karma，这一步就不需要了。</p> <ol start="5"><li>学会使用无头浏览器</li></ol> <p>无头浏览器就是看不见界面但是确实存在的浏览器。PhantomJS 就是一个早期的无头浏览器，已经很老了，跟它差不多名字的还有一个叫作 PhantomCSS，前者管 js，后者管 css。</p> <ol start="6"><li>新建一个 src 目录，把 index.js 移动到 src 目录下。然后在 karma 配置文件中配置：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 需要进行测试的文件</span>
files<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;./src/**/*.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;./tests/unit/**/*.spec.js&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="7"><li>再设置 singleRun 为 true</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>singleRun<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="8"><li>接下来还需要安装以下包：</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install karma-jasmine jasmine-core --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="9"><li>在 package.json 中添加脚本命令：</li></ol> <div class="language-json line-numbers-mode"><pre class="language-json"><code>scripts<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;karma start&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后就可以运行 npm test 命令启动测试流程了。然而报错了：</p> <p><img src="/assets/img/karma4.4088e8e1.png" alt="karma" title="karma"></p> <p>查看报错信息就会发现，原来是没找到 PhantomJS 这个无头浏览器，官网之所以没有提及这个，是因为它一开始就装了 chorme。</p> <p><img src="/assets/img/karma5.f869e1fb.png" alt="karma" title="karma"></p> <ol start="10"><li>安装 <a href="https://www.npmjs.com/package/phantomjs" target="_blank" rel="noopener noreferrer">PhantomJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这个包太老了，npm 上都不维护了。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install phantomjs --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但是下载过程太慢了，没办法换成 cnpm 来下载。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cnpm install phantomjs --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装完成后重新运行 npm test，发现还是不行，报了同样的问题。所以我们还得再安装一个适配器 karma-phantomjs-launcher。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install karma-phantomjs-launcher --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>重新运行 npm test 就可以看到启动成功了。</p> <p><img src="/assets/img/karma6.b8b9faa7.png" alt="karma" title="karma"></p> <p>图里展示我们的测试用例也测试通过了。</p> <p>此时如果把测试用例改成：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.spec.js</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'函数基本测试用例'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'+1测试函数'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>就会发现测试不通过了。</p> <p><img src="/assets/img/karma7.0ad83d4d.png" alt="karma" title="karma"></p> <ol start="11"><li>查看测试覆盖率</li></ol> <p>接下来把 index.js 代码改一下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
window<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>相应的，index.spec.js 也得改：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'函数基本测试用例'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'+1测试函数'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>因为代码里有 if ... else 分支，所以测试用例需要写两个 expect，如果只写一个的话，就会导致测试覆盖率不全。</p> <p>那么，如何查看测试覆盖率呢？</p> <p>（1）新建一个 docs 文件夹，用来生成测试报告给别人看。</p> <p>（2）安装测试覆盖率检查工具 <a href="https://www.npmjs.com/package/karma-coverage" target="_blank" rel="noopener noreferrer">karma-coverage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install karma-coverage --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（3）安装完成后，需要改下 karma 的配置文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>preprocessors<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// 测试哪些文件对应的覆盖率</span>
  <span class="token string">'src/**/*.js'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'coverage'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

reporters<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'progress'</span><span class="token punctuation">,</span> <span class="token string">'coverage'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token comment">// 报表生成的位置</span>
coverageReporter<span class="token operator">:</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'html'</span><span class="token punctuation">,</span>
  dir<span class="token operator">:</span> <span class="token string">'docs/coverage/'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>（4）重新运行 npm test，就会看到 docs 目录下生成了一些文件。</p> <p><img src="/assets/img/karma8.103c5413.png" alt="karma" title="karma"></p> <p>（5）打开 index.html，就可以在浏览器中看到测试报告。覆盖率是通过分支语句计算出来的。</p> <p><img src="/assets/img/karma9.9db67601.png" alt="karma" title="karma"></p> <p>点击 index.js 还能看到具体是哪行代码测试不通过。</p> <p><img src="/assets/img/karma10.64683e5d.png" alt="karma" title="karma"></p> <p>（6）把 index.js 再改下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'函数基本测试用例'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'+1测试函数'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>重新运行就可以看到所有测试用例通过了。</p> <p><img src="/assets/img/karma11.0c0e85b9.png" alt="karma" title="karma"></p> <ol start="12"><li>UI 自动化测试</li></ol> <p>（1）一个比较好用的库：<a href="https://github.com/obfuscurity/backstop" target="_blank" rel="noopener noreferrer">backstop github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://www.npmjs.com/package/backstopjs" target="_blank" rel="noopener noreferrer">backstop npm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>（2）全局安装</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo npm install -g backstopjs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>npm 安装实在是太慢了，没办法只能用 cnpm</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo cnpm install -g backstopjs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（3）安装好之后运行以下命令，会生成 backstop 的配置文件 backstop.json 和 backstop_data 文件夹。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>backstop init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/karma12.2dbe0a9b.png" alt="karma" title="karma"></p> <p>（4）把 backstop.json 文件中的 id 和 scenarios 对象中的 url 改成腾讯地图：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;qq&quot;</span>

<span class="token property">&quot;scenarios&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://map.qq.com/m/&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>（5）puppeteer</p> <p>这是当下最新的无头浏览器，生态也比较广。<a href="https://github.com/puppeteer/puppeteer" target="_blank" rel="noopener noreferrer">puppeteer github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>puppet 文件夹下的东西就是用来操作这个的。puppet 也是一个库，<a href="https://www.npmjs.com/package/puppet" target="_blank" rel="noopener noreferrer">puppet npm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/puppetlabs/puppet" target="_blank" rel="noopener noreferrer">puppet github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="/assets/img/karma13.bff559ef.png" alt="karma" title="karma"></p> <p>（6）运行以下命令：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>backstop test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行完成后会自动在浏览器中弹出以下页面：</p> <p><img src="/assets/img/karma14.09c71669.png" alt="karma" title="karma"></p> <p>这个时候可以发现 backstop_data 文件夹下多出了两个文件夹。</p> <p><img src="/assets/img/karma15.74ff13bb.png" alt="karma" title="karma"></p> <p>其中，bitmaps_test 文件夹存放的就是你的页面，页面的尺寸就是跟 backstop.json 里面设置的尺寸一样的。</p> <p><img src="/assets/img/karma16.b9aa8c6c.png" alt="karma" title="karma"></p> <p>而 html_report 文件夹存放的是生成的一些报表。</p> <p>（7）刚刚执行命令的时候还会发现报错了，说没有找到图片。</p> <p><img src="/assets/img/karma17.8338460a.png" alt="karma" title="karma"></p> <p>没找到是因为这里的路径没找到。</p> <p><img src="/assets/img/karma18.4293da17.png" alt="karma" title="karma"></p> <p>（8）直接在 backstop_data 文件夹中新建一个 bitmaps_reference 文件夹。然后让 UI 把新的图放这个文件夹里边。同时删掉 bitmaps_test 文件夹。</p> <p><img src="/assets/img/karma19.aee14ec9.png" alt="karma" title="karma"></p> <p>（9）重新执行 backstop test 命令，就能看到自己的页面跟 UI 设计的图哪些地方不一样了。</p> <p><img src="/assets/img/karma20.a574421c.png" alt="karma" title="karma"></p> <p><img src="/assets/img/karma21.8aa556bc.png" alt="karma" title="karma"></p> <p>（10）由于生成的报表很重要，接下来我们把生成报表的路径改一下。然后重新执行命令就可以了，就会在 docs 生成一个 html_report 目录。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;bitmaps_reference&quot;</span><span class="token operator">:</span> <span class="token string">&quot;backstop_data/bitmaps_reference&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;bitmaps_test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;backstop_data/bitmaps_test&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;engine_scripts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;backstop_data/engine_scripts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;html_report&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docs/html_report&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 修改报表生成位置</span>
  <span class="token property">&quot;ci_report&quot;</span><span class="token operator">:</span> <span class="token string">&quot;backstop_data/ci_report&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>（11）先把上面的基本流程练熟了之后，接下来就是要去熟悉操作 puppet 里面的东西了。</p> <h2 id="e2e-测试实战"><a href="#e2e-测试实战" class="header-anchor">#</a> e2e 测试实战</h2> <ol><li><p>在 tests 目录下新建 e2e 文件夹。</p></li> <li><p>e2e 测试最流行的框架是 <a href="https://www.npmjs.com/package/selenium-webdriver" target="_blank" rel="noopener noreferrer">selenium-webdriver<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，同时它也是学习自动化测试最关键的一个库。</p></li></ol> <p>（1）安装这个库</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install selenium-webdriver
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（2）安装驱动，安装推荐的任意一个都可以</p> <p><img src="/assets/img/selenium-webdriver1.abbad0ab.png" alt="selenium-webdriver" title="selenium-webdriver"></p> <p>（3）这里选择安装 FireFox 的驱动。</p> <p><img src="/assets/img/selenium-webdriver2.205ef3e3.png" alt="selenium-webdriver" title="selenium-webdriver"></p> <p>（4）下载完成后解压缩，然后把 geckodriver 放到项目的根目录下。</p> <p><img src="/assets/img/selenium-webdriver3.787027f6.png" alt="selenium-webdriver" title="selenium-webdriver"></p> <p>（5）接着在 e2e 目录下新建一个 baidu.spec.js 文件，然后到 selenium-webdriver 的 npm 上复制下面这段代码到这个文件中，地址改成百度的地址。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>Builder<span class="token punctuation">,</span> By<span class="token punctuation">,</span> Key<span class="token punctuation">,</span> until<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'selenium-webdriver'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> driver <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forBrowser</span><span class="token punctuation">(</span><span class="token string">'firefox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> driver<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> driver<span class="token punctuation">.</span><span class="token function">findElement</span><span class="token punctuation">(</span>By<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'wd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendKeys</span><span class="token punctuation">(</span><span class="token string">'深圳大学'</span><span class="token punctuation">,</span> Key<span class="token punctuation">.</span><span class="token constant">RETURN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> driver<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>until<span class="token punctuation">.</span><span class="token function">titleIs</span><span class="token punctuation">(</span><span class="token string">'深圳大学_百度搜索'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> driver<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>（6）接着执行以下命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>node ./tests/e2e/baidu.spec.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但是出现了以下问题。</p> <p><img src="/assets/img/selenium-webdriver4.687c36fa.png" alt="selenium-webdriver" title="selenium-webdriver"></p> <p>想了一下，猜测可能是因为我没有安装火狐浏览器，于是下载安装了一个。然后重新运行命令，就发现成功了。命令执行完成后会自动打开火狐浏览器，百度搜索深圳大学，然后再关闭，说明端到端测试完成了。这就是最简单的 e2e 测试。</p> <ol start="3"><li><p><a href="https://nightwatchjs.org/" target="_blank" rel="noopener noreferrer">Nightwatch.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是另一个端到端测试框架，写起来很爽，但是配置起来太复杂、太难了。</p></li> <li><p><a href="https://www.cypress.io/" target="_blank" rel="noopener noreferrer">Cypress<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 也是一个端到端测试框架，这个就以配置简单闻名，而且有中文文档。</p></li> <li><p><a href="https://rize.js.org/zh-CN/#%E7%89%B9%E6%80%A7" target="_blank" rel="noopener noreferrer">Rize.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个提供顶层的、流畅并且可以链式调用的 API 的库，它能让您简单地使用 puppeteer。它的 api 很少，但是却够用。puppeteer 本身是基于 Chrome 的，它的不足就是只能测 Chrome，不能测其他浏览器。</p></li></ol> <p>（1）执行以下命令安装 puppeteer 和 rize。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install --save-dev puppeteer rize
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>npm 安装太慢了，最后使用 cnpm 安装。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cnpm install --save-dev puppeteer rize
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（2）安装完成后，在 e2e 文件夹下新建 github.spec.js 文件，并写入以下代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Rize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rize'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> rize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

rize
  <span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://github.com/'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'input.header-search-input'</span><span class="token punctuation">,</span> <span class="token string">'node'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">press</span><span class="token punctuation">(</span><span class="token string">'Enter'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">waitForNavigation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">assertSee</span><span class="token punctuation">(</span><span class="token string">'Node.js'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 别忘了调用 `end` 方法来退出浏览器！</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>（3）执行以下命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>node ./tests/e2e/github.spec.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行命令后需要等待一下，因为是无头浏览器，所以什么东西也看不到，只能等。如果执行成功，就会自动退出命令，如果执行不成功，就会报错。</p> <ol start="6"><li><p><a href="https://jestjs.io/zh-Hans/" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是比较全面的一个测试框架，什么都能做，还是希望能够多去使用下，因为后面很多项目实战都会用到。如果项目是 react，那测试框架就选这个了。如果是 vue，就选 cypress。唯一的弱点就是不适合做异步。</p></li> <li><p>mocha + chai 和 Jest 是 vue 项目推荐的两套单元测试框架。Cypress 和 Nightwatch 是 vue 项目推荐的两套端到端测试框架。</p></li></ol> <h2 id="接口测试实战"><a href="#接口测试实战" class="header-anchor">#</a> 接口测试实战</h2> <p><a href="https://mochajs.cn/" target="_blank" rel="noopener noreferrer">mocha<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 主要用来做接口测试，因为它适合做异步测试。下面就来使用下它。</p> <ol><li>在 tests 目录下新建 service 文件夹，并建一个 app.js 文件。从 <a href="https://koa.bootcss.com/" target="_blank" rel="noopener noreferrer">koa<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 官网上复制一段代码放到文件中。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token string">'深圳大学'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务启动成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="2"><li>接着安装 koa</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install koa --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>安装好之后执行</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>node ./tests/service/app.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后浏览器中访问 localhost:3000 就能看到接口返回的 json。</p> <ol start="4"><li>在 service 目录下再建一个 app.spec.js 文件。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> superagent <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'supertest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">superagent</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'NodeUii 自动化脚本'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'获取后台接口数据'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Accept'</span><span class="token punctuation">,</span> <span class="token string">'application/json'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token regex">/json/</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'请求出错！'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>body<span class="token punctuation">.</span>data <span class="token operator">===</span> <span class="token string">'深圳大学'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'接口数据出错！'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'404容错脚本'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user?'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> done<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>然后 app.js 中要加一句 module.exports = app;，同时还要安装 superagent、mocha 和 mochawesome：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install superagent mocha mochawesome --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="5"><li>接着在根目录下创建一个 mochaRunner.js 文件。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Mocha <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mocha'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mocha <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mocha</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    reporter<span class="token operator">:</span> <span class="token string">'mochawesome'</span><span class="token punctuation">,</span>
    reporterOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        reportDir<span class="token operator">:</span> <span class="token string">'docs/mochawesome-report'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

mocha<span class="token punctuation">.</span><span class="token function">addFile</span><span class="token punctuation">(</span><span class="token string">'./tests/service/app.spec.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

mocha<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>此时发现不应该安装 superagent，而是要安装 supertest：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install supertest --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="6"><li>接着运行以下命令</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>node mochaRunner.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但是此时报错了</p> <p><img src="/assets/img/mocha1.d3af0ce8.png" alt="mocha" title="mocha"></p> <p>检查发现是 res.body.data 而不是 res.body。重新运行就可以了。</p> <p><img src="/assets/img/mocha2.0c7436f2.png" alt="mocha" title="mocha"></p> <p>可以看到有1个用例成功了，1个用例失败了，此时在 docs 目录下同样能看到生成的文件。</p> <p><img src="/assets/img/mocha3.9a0b7470.png" alt="mocha" title="mocha"></p> <p>打开 mochawesome.html 文件，就可以看到性能测试报告了。</p> <p><img src="/assets/img/mocha4.605e6192.png" alt="mocha" title="mocha"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javascript/jsUtils.html" class="prev">
        JavaScript常用工具方法
      </a></span> <span class="next"><a href="/javascript/jsTest.html">
        JavaScript基础测试
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.83f3402d.js" defer></script><script src="/assets/js/2.a0a69aa9.js" defer></script><script src="/assets/js/3.8959ecef.js" defer></script>
  </body>
</html>
