<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>现代浏览器的进化 | 鸵鸟蛋的个人主页</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/image/logo.jpg">
    <meta name="description" content="鸵鸟蛋的世界">
    <link rel="preload" href="/assets/css/0.styles.22095322.css" as="style"><link rel="preload" href="/assets/js/app.83f3402d.js" as="script"><link rel="preload" href="/assets/js/2.a0a69aa9.js" as="script"><link rel="preload" href="/assets/js/12.a66aca6c.js" as="script"><link rel="prefetch" href="/assets/js/10.439f342d.js"><link rel="prefetch" href="/assets/js/11.216a07f2.js"><link rel="prefetch" href="/assets/js/13.f5f24ce3.js"><link rel="prefetch" href="/assets/js/14.32d895c9.js"><link rel="prefetch" href="/assets/js/15.623a8373.js"><link rel="prefetch" href="/assets/js/16.31912b5c.js"><link rel="prefetch" href="/assets/js/17.68031807.js"><link rel="prefetch" href="/assets/js/18.a66b9dd4.js"><link rel="prefetch" href="/assets/js/19.c3c1ad4e.js"><link rel="prefetch" href="/assets/js/20.67c9540c.js"><link rel="prefetch" href="/assets/js/21.722fe9fe.js"><link rel="prefetch" href="/assets/js/22.72f8f629.js"><link rel="prefetch" href="/assets/js/23.f730e8f1.js"><link rel="prefetch" href="/assets/js/24.9e67058b.js"><link rel="prefetch" href="/assets/js/25.81a3aeea.js"><link rel="prefetch" href="/assets/js/26.18ba7257.js"><link rel="prefetch" href="/assets/js/27.eee6c364.js"><link rel="prefetch" href="/assets/js/28.d2732972.js"><link rel="prefetch" href="/assets/js/29.d54fb216.js"><link rel="prefetch" href="/assets/js/3.8959ecef.js"><link rel="prefetch" href="/assets/js/30.e71f561f.js"><link rel="prefetch" href="/assets/js/31.4f56f5c3.js"><link rel="prefetch" href="/assets/js/32.4ecd4417.js"><link rel="prefetch" href="/assets/js/33.32d721bd.js"><link rel="prefetch" href="/assets/js/34.ab789bed.js"><link rel="prefetch" href="/assets/js/35.e2330e74.js"><link rel="prefetch" href="/assets/js/36.a4d7a3e2.js"><link rel="prefetch" href="/assets/js/37.ca9e6d12.js"><link rel="prefetch" href="/assets/js/38.8e7d9dae.js"><link rel="prefetch" href="/assets/js/39.818446de.js"><link rel="prefetch" href="/assets/js/4.bc08363f.js"><link rel="prefetch" href="/assets/js/40.6e5412c0.js"><link rel="prefetch" href="/assets/js/41.c046cc2c.js"><link rel="prefetch" href="/assets/js/42.3a98e5b0.js"><link rel="prefetch" href="/assets/js/43.c48084fd.js"><link rel="prefetch" href="/assets/js/44.9a68e6e8.js"><link rel="prefetch" href="/assets/js/45.607f9d7b.js"><link rel="prefetch" href="/assets/js/46.4fbd5727.js"><link rel="prefetch" href="/assets/js/47.ff6cd126.js"><link rel="prefetch" href="/assets/js/48.4e44b645.js"><link rel="prefetch" href="/assets/js/49.b3559737.js"><link rel="prefetch" href="/assets/js/5.247f2124.js"><link rel="prefetch" href="/assets/js/50.4c05ad25.js"><link rel="prefetch" href="/assets/js/51.27325a7b.js"><link rel="prefetch" href="/assets/js/52.62b7f674.js"><link rel="prefetch" href="/assets/js/53.fe6c2e96.js"><link rel="prefetch" href="/assets/js/54.68c91b01.js"><link rel="prefetch" href="/assets/js/55.a4e116a4.js"><link rel="prefetch" href="/assets/js/56.adec72d4.js"><link rel="prefetch" href="/assets/js/57.c8755c55.js"><link rel="prefetch" href="/assets/js/58.99e5de2f.js"><link rel="prefetch" href="/assets/js/59.f7deea0d.js"><link rel="prefetch" href="/assets/js/6.9cd44cad.js"><link rel="prefetch" href="/assets/js/60.608e9336.js"><link rel="prefetch" href="/assets/js/7.d1cbdc31.js"><link rel="prefetch" href="/assets/js/8.3e9a3d41.js"><link rel="prefetch" href="/assets/js/9.698ca62a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.22095322.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">鸵鸟蛋的个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://starcoderln.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/StarCoderLn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://starcoderln.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/StarCoderLn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VuePress</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>函数式编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面向切面编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>浏览器</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/browser/chrome.html" class="active sidebar-link">Chrome 浏览器渲染机制内幕</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/browser/chrome.html#现代浏览器的进化" class="sidebar-link">现代浏览器的进化</a></li><li class="sidebar-sub-header"><a href="/browser/chrome.html#现代浏览器的特征" class="sidebar-link">现代浏览器的特征</a></li><li class="sidebar-sub-header"><a href="/browser/chrome.html#现代浏览器的结构" class="sidebar-link">现代浏览器的结构</a></li><li class="sidebar-sub-header"><a href="/browser/chrome.html#常见的渲染引擎" class="sidebar-link">常见的渲染引擎</a></li><li class="sidebar-sub-header"><a href="/browser/chrome.html#渲染引擎的工作流程" class="sidebar-link">渲染引擎的工作流程</a></li><li class="sidebar-sub-header"><a href="/browser/chrome.html#渲染引擎的组成模块" class="sidebar-link">渲染引擎的组成模块</a></li><li class="sidebar-sub-header"><a href="/browser/chrome.html#chrome-架构" class="sidebar-link">Chrome 架构</a></li><li class="sidebar-sub-header"><a href="/browser/chrome.html#chrome-渲染器进程" class="sidebar-link">Chrome 渲染器进程</a></li><li class="sidebar-sub-header"><a href="/browser/chrome.html#chrome-渲染过程" class="sidebar-link">Chrome 渲染过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/browser/chrome.html#解析部分" class="sidebar-link">解析部分</a></li><li class="sidebar-sub-header"><a href="/browser/chrome.html#合成部分" class="sidebar-link">合成部分</a></li><li class="sidebar-sub-header"><a href="/browser/chrome.html#gpu-渲染" class="sidebar-link">GPU 渲染</a></li></ul></li><li class="sidebar-sub-header"><a href="/browser/chrome.html#初窥-webkit" class="sidebar-link">初窥 WebKit</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端监控</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法学习总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac 开发体验优化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="现代浏览器的进化"><a href="#现代浏览器的进化" class="header-anchor">#</a> 现代浏览器的进化</h2> <ul><li><p>1990年，蒂姆·伯纳斯·李开发了第一个网页浏览器 <strong>WorldWideWeb</strong>，后改名为 <strong>Nexus</strong>。WorldWideWeb 浏览器支持早期的 HTML 标记语言，功能比较简单，只能支持文本、简单的样式表、电影、声音、图片等资源的显示。</p></li> <li><p>1993年，马克·安德森领导的团开发了一个真正有影响力的浏览器 <strong>Mosaic</strong>，这就是后来世界上最流行的浏览器 <strong>Netscape Navigator</strong>。</p></li> <li><p>1995年，微软推出了闻名于世的浏览器 <strong>Internet Explorer</strong>。<strong>第一次浏览器大战开始，持续两年</strong>。</p></li> <li><p>1998年，Netscape 公司开放 Netscape Navigator 源代码，成立了 Mozilla 基金会。<strong>第二次浏览器大战开始，持续八年</strong>。</p></li> <li><p>2003年，苹果公司发布了 <strong>Safari</strong> 浏览器。</p></li> <li><p>2004年，Netscape 公司发布了著名的开源浏览器 <strong>Mozilla Firefox</strong>。</p></li> <li><p>2005年，苹果公司开源了浏览器中的核心代码，基于此发起了一个新的开源项目 WebKit(Safari 浏览器的内核)。</p></li> <li><p>2008年， Google 公司以 WebKit 为内核，创建了一个新的浏览器项目 <strong>Chromium</strong>。以 Chromium 为基础，谷歌发布了 <strong>Chrome</strong> 浏览器。 至于这两者的关系，可以简单地理解为：Chromium 为实验版，具有众多新特性；Chrome 为稳定版。</p></li></ul> <h2 id="现代浏览器的特征"><a href="#现代浏览器的特征" class="header-anchor">#</a> 现代浏览器的特征</h2> <ul><li><p>网络</p></li> <li><p>资源缓存</p></li> <li><p>网页浏览</p></li> <li><p>多页面管理</p></li> <li><p>插件和扩展</p></li> <li><p>账户和同步</p></li> <li><p>安全机制</p></li> <li><p>开发者工具</p></li></ul> <h2 id="现代浏览器的结构"><a href="#现代浏览器的结构" class="header-anchor">#</a> 现代浏览器的结构</h2> <p><img src="/assets/img/browser1.ee7823a6.png" alt="browser" title="browser"></p> <p>浏览器主要包含8个子系统：</p> <p>📌 <strong>1. 用户界面（User Interface）</strong></p> <ul><li><p>主要包括工具栏、地址栏、前进/后退按钮、书签菜单、可视化页面加载进度、智能下载处理、首选项、打印等。除了浏览器主窗口显示请求的页面之外，其他显示的部分都属于用户界面。</p></li> <li><p>可以与桌面环境集成，以提供浏览器会话管理或与其他桌面应用程序的通信。</p></li></ul> <p>📌 <strong>2. 浏览器引擎（Browser Engine）</strong></p> <ul><li><p>是一个可嵌入的组件，其为渲染引擎提供高级接口。</p></li> <li><p>可以加载一个给定的URI，并支持诸如：前进/后退/重新加载等浏览操作。</p></li> <li><p>提供查看浏览会话的各个方面的挂钩，例如：当前页面加载进度、JavaScript alert。</p></li> <li><p>允许查询/修改渲染引擎设置。</p></li></ul> <p>📌 <strong>3. 渲染引擎（Rendering Engine）</strong></p> <ul><li><p>为指定的URI生成可视化的表示。</p></li> <li><p>能够显示HTML和XML文档，可选择CSS样式，以及嵌入式内容（如图片）。</p></li> <li><p>能够准确计算页面布局，可使用“回流”算法逐步调整页面元素的位置。</p></li> <li><p>内部包含HTML解析器。</p></li></ul> <p>📌 <strong>4. 网络（Networking）</strong></p> <ul><li><p>实现 HTTP 和 FTP 等文件传输协议。</p></li> <li><p>可以在不同的字符集之间进行转换，为文件解析 MIME 媒体类型。</p></li> <li><p>可以实现最近检索资源的缓存功能。</p></li></ul> <p>📌 <strong>5. JS 解释器（JavaScript Interpreter）</strong></p> <ul><li><p>能够解释并执行嵌入在网页中的JavaScript（又称ECMAScript）代码。</p></li> <li><p>为了安全起见，浏览器引擎或渲染引擎可能会禁用某些 JavaScript 功能，如弹出窗口的打开。</p></li></ul> <p>📌 <strong>6. XML 解析器（XML Parser）</strong></p> <ul><li><p>可以将 XML 文档解析成文档对象模型（Document Object Model，DOM）树。</p></li> <li><p>是浏览器架构中复用最多的子系统之一，几乎所有的浏览器实现都利用现有的 XML 解析器，而不是从头开始创建自己的 XML 解析器。</p></li> <li><p>XML 解析方式主要有 DOM 和 SAX 解析两种。</p></li></ul> <p>📌 <strong>7. 显示后端（Display Backend）</strong></p> <ul><li>提供绘图和窗口原语，包括：用户界面控件集合、字体集合。</li></ul> <p>📌 <strong>8. 数据持久层（Data Persistence）</strong></p> <ul><li>将与浏览会话相关联的各种数据存储在硬盘上。这些数据可能是诸如：书签、工具栏设置等这样的高级数据，也可能是诸如：Cookie，安全证书、缓存等这样的低级数据。</li></ul> <h2 id="常见的渲染引擎"><a href="#常见的渲染引擎" class="header-anchor">#</a> 常见的渲染引擎</h2> <ol><li><p>渲染引擎能够将 HTML/CSS/JavaScript 文本及相应的资源文件转换成图像结果。</p></li> <li><p>浏览器内核分为两部分：渲染引擎和 JS 引擎。最开始渲染引擎和 JS 引擎没有区分的很明确，后来 JS 引擎越来越独立，内核就倾向于只指渲染引擎。</p></li></ol> <table><thead><tr><th>浏览器</th> <th>Chrome</th> <th>Firefox</th> <th>Safari</th> <th>IE</th> <th>Edge</th> <th>Opera</th></tr></thead> <tbody><tr><td>内核</td> <td>Blink</td> <td>Gecko</td> <td>WebKit</td> <td>Trident</td> <td>EdgeHTML</td> <td>Presto</td></tr> <tr><td>JS 引擎</td> <td>V8</td> <td>JagerMonkey</td> <td>SquirrelFish Extreme</td> <td>JScritp、Chakra</td> <td>Chakra</td> <td>Carakan</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">说明</p> <ol><li><p>2008年谷歌公司发布了 Chrome 浏览器，浏览器使用的内核被命名为 Chromium，Chromium fork 自开源引擎 WebKit。最开始 Chrome 采用 WebKit 作为浏览器内核，直到2013年开始使用 WebKit 的分支内核 Blink。</p></li> <li><p>IE6-8 用的 JS 引擎是 JScritp，IE9-11 用的 JS 引擎是 Chakra。</p></li></ol></div> <h2 id="渲染引擎的工作流程"><a href="#渲染引擎的工作流程" class="header-anchor">#</a> 渲染引擎的工作流程</h2> <p>渲染引擎的渲染流程示意图如下，其以 HTML/JavaScript/CSS 等文件作为输入，以可视化内容作为输出。</p> <p><img src="/assets/img/browser2.6750c0f4.png" alt="browser" title="browser"></p> <p>📌 <strong>1. Parsing HTML to Construct DOM Tree</strong></p> <ul><li><p>渲染引擎使用 HTML 解析器（调用 XML 解析器）解析 HTML（XML）文档，将各个 HTML（XML）元素逐个转化成 DOM 节点，从而生成 DOM 树。</p></li> <li><p>同时，渲染引擎使用 CSS 解析器解析外部 CSS 文件以及 HTML（XML）元素中的样式规则。</p></li></ul> <p>📌 <strong>2. Render Tree construction</strong></p> <ul><li><p>渲染引擎使用第1步 CSS 解析器解析得到的样式规则，将其附着到 DOM 树上，从而构成渲染树。</p></li> <li><p>渲染树包含多个带有视觉属性（如颜色和尺寸）的矩形。这些矩形的排列顺序就是它们将在屏幕上显示的顺序。</p></li></ul> <p>📌 <strong>3. Layout of Render Tree</strong></p> <ul><li>渲染树构建完毕之后，进入本阶段进行“布局”，也就是为每个节点分配一个应出现在屏幕上的确切坐标。</li></ul> <p>📌 <strong>4. Painting Render Tree</strong></p> <p>渲染引擎将遍历渲染树，并调用显示后端将每个节点绘制出来。</p> <h2 id="渲染引擎的组成模块"><a href="#渲染引擎的组成模块" class="header-anchor">#</a> 渲染引擎的组成模块</h2> <p><img src="/assets/img/browser3.6c02aaf5.png" alt="browser" title="browser"></p> <p>上图所示为渲染引擎工作流程中各个步骤所对应的模块，其中第1步和第2步涉及到多个模块，并且耦合程度较高。</p> <p>这样的设计是为了达到更好的用户体验，渲染引擎尽快将内容显示在屏幕上。它不必等到整个HTML文档解析完毕之后，就可以开始渲染树构建和布局设置。在不断接收和处理来自网络的其余内容的同时，渲染引擎会将部分内容解析并显示出来。</p> <p>从图中可以看出，渲染引擎主要包含（或调用）的模块有：</p> <ul><li><strong>HTML（XML）解析器</strong></li></ul> <p>解析 HTML（XML）文档，主要作用是将 HTML（XML）文档转换成 DOM 树。</p> <ul><li><strong>CSS 解析器</strong></li></ul> <p>将 DOM 中的各个元素对象进行计算，获取样式信息，用于渲染树的构建。</p> <ul><li><strong>JavaScript 解释器</strong></li></ul> <p>使用 JavaScript 可以修改网页的内容、CSS 规则等。JavaScript 解释器能够解释 JavaScript 代码，并通过 DOM 接口和 CSSOM 接口来修改网页内容、样式规则，从而改变渲染结果。</p> <ul><li><strong>布局</strong></li></ul> <p>DOM 创建之后，渲染引擎将其中的元素对象与样式规则进行结合，可以得到渲染树。布局则是针对渲染树，计算其各个元素的大小、位置等布局信息。</p> <ul><li><strong>绘图</strong></li></ul> <p>使用图形库将布局计算后的渲染树绘制成可视化的图像结果。</p> <p>以上这些模块都是操作 <strong>DOM 树</strong>（<strong>DOM Tree</strong>）和<strong>渲染树</strong>（<strong>Render Tree</strong>）这两个核心数据结构的。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <ul><li><p><strong>这块地方是重点，要吃透！尤其是其中的流程和数据流向，这两点在软件架构设计中也是很重要的。</strong></p></li> <li><p>这个图有一个不太恰当的地方就是，CSS 解析器和 JavaScript 解释器应该是和 HTML（XML）解析器同时从入口文件那里分开的，而不是前两者从 HTML（XML）解析器那里分开。</p></li> <li><p>但其实，JS 和 CSS 也是通过 HTML 中的链接引进来或者嵌在 HTML 中的，所以它们从 HTML（XML）解析器那里分开也说的过去。</p></li></ul></div> <h2 id="chrome-架构"><a href="#chrome-架构" class="header-anchor">#</a> Chrome 架构</h2> <p><img src="/assets/img/browser4.07f90e39.png" alt="browser" title="browser"></p> <ul><li><p>Browser：浏览器的主进程，控制 chrome 的应用程序部分，包括地址栏，书签，后退和前进按钮。还处理 Web 浏览器的不可见的和特权部分，例如网络请求和文件访问。</p></li> <li><p>Renderer：渲染器进程，负责显示网站的选项卡内的所有内容。</p></li> <li><p>Plugin：控制网站使用的所有插件，例如 flash。</p></li> <li><p>GPU：独立于其他进程的 GPU 处理任务。它被分成多个不同的进程，因为 GPU 处理来自多个程序的请求并将它们绘制在同一个页面中。</p></li></ul> <p>📌 <strong>1. Chrome 采用多进程架构的好处</strong></p> <ul><li><p>每个选项卡都有自己的渲染器进程。假设你打开了 3 个选项卡，每个选项卡都拥有独立的渲染器进程。如果一个选项卡没有响应，则可以关闭无响应的选项卡，并继续使用，同时保持其他选项卡处于活动状态。如果所有选项卡，都在一个进程上运行，则当一个选项卡无响应时，所有选项卡都不会响应。这就很尴尬了。</p></li> <li><p>分成多个进程的另一个好处是安全性和沙盒。由于操作系统提供了限制进程权限的方法，因此浏览器可以从某些功能中，对某些进程进行沙箱处理。例如，Chrome 浏览器可以对处理用户输入（如渲染器）的进程，限制其文件访问的权限。</p></li></ul> <p>📌 <strong>2. Chrome 服务化——更省内存</strong></p> <ul><li><p>每个进程都有自己的私有内存空间，因此它们通常包含公有基础功能（例如 V8 是 Chrome 的 JavaScript 引擎）。这意味着更多的内存使用，因为如果它们是同一进程内的线程，则无法以它们的方式共享。</p></li> <li><p>为了节省内存，Chrome 限制了它可以启动的进程数量。限制会根据设备的内存和 CPU 功率动态调整，但当 Chrome 达到限制时，它会在一个新的进程中打开这个站点。</p></li> <li><p>Chrome 正在进行体系结构更改，以便将浏览器程序的每个部分，作为一项服务运行，从而可以轻松拆分为不同的流程或汇总为同一个流程。</p></li> <li><p>一般的想法是，当 Chrome 在强大的硬件上运行时，它可能会将每个服务拆分为不同的进程，从而提供更高的稳定性，但如果它位于资源约束的设备上，Chrome 会将服务整合到一个进程中，从而节省内存占用。</p></li></ul> <p><img src="/assets/img/browser1.f6ff53f3.gif" alt="browser" title="browser"></p> <h2 id="chrome-渲染器进程"><a href="#chrome-渲染器进程" class="header-anchor">#</a> Chrome 渲染器进程</h2> <p><img src="/assets/img/browser5.f1539b08.png" alt="browser" title="browser"></p> <ol><li><p>渲染器进程负责选项卡内发生的所有事情。在渲染器进程中，主线程处理你为用户编写的大部分代码。</p></li> <li><p>如果你使用了 web worker 或 service worker，有时 JavaScript 代码的一部分将由工作线程处理。排版和栅格线程也在渲染器进程内运行，以便高效、流畅地呈现页面。</p></li></ol> <h2 id="chrome-渲染过程"><a href="#chrome-渲染过程" class="header-anchor">#</a> Chrome 渲染过程</h2> <h3 id="解析部分"><a href="#解析部分" class="header-anchor">#</a> 解析部分</h3> <ul><li><p>构建 DOM</p></li> <li><p>子资源加载，比如 JS 和 CSS 资源</p></li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <ol><li><p>JavaScript 会阻止 DOM 解析，这就是要把 script 脚本放在页面底部的原因。</p></li> <li><p>构建 DOM 的过程中如果发现子资源，就会立即进行网络请求，这两步是并行进行的，不是串行的。</p></li></ol></div> <ul><li>提示浏览器如何加载资源</li></ul> <p><img src="/assets/img/browser6.ecf2c1d5.png" alt="browser" title="browser"></p> <ul><li>样式表计算，将样式表中定义的每个样式跟对应的 DOM 元素进行关联。</li></ul> <p><img src="/assets/img/browser7.a94db3b1.png" alt="browser" title="browser"></p> <ul><li>布局</li></ul> <p><img src="/assets/img/browser8.70d44b64.png" alt="browser" title="browser"></p> <ul><li>绘制，在进行绘制之前，还要先进行合成，再交给 GPU 去渲染。</li></ul> <h3 id="合成部分"><a href="#合成部分" class="header-anchor">#</a> 合成部分</h3> <ul><li><p>把文档的结构、元素的样式、几何形状和绘制顺序转换为屏幕上的像素点的过程称为<strong>光栅化（栅格化）</strong>。</p></li> <li><p>合成是一种将页面的各个部分分层，分别栅格化，并在一个被称为合成器线程的独立线程中合成为页面的技术。</p></li></ul> <p><img src="/assets/img/browser9.75aa676c.png" alt="browser" title="browser"></p> <h3 id="gpu-渲染"><a href="#gpu-渲染" class="header-anchor">#</a> GPU 渲染</h3> <ul><li><p>一旦创建了层树并确定了绘制顺序，主线程就会将该信息提交给合成器线程。然后合成器线程栅格化每个图层。 一个图层可能像页面的整个长度一样大，因此<strong>合成器线程会将它们分成图块 tile，并将每个图块发送到光栅线程</strong>。栅格线程栅格化每一个 tile 并将它们存储在 GPU 内存中。</p></li> <li><p>通过 IPC 将合成器帧提交给浏览器进程。这时可以从 UI 线程添加另一个合成器帧以用于浏览器 UI 更改，或者从其他渲染器进程添加扩充数据。这些合成器帧被发送到GPU 用来在屏幕上显示。如果发生滚动事件，合成器线程会创建另一个合成器帧并发送到 GPU。</p></li> <li><p>合成的好处是它可以在不涉及主线程的情况下完成。合成线程不需要等待样式计算或 JavaScript 执行。这就是合成动画是平滑性能的最佳选择的原因。如果需要再次计算布局或绘图，则必须涉及主线程。</p></li></ul> <p><img src="/assets/img/browser10.4192db22.png" alt="browser" title="browser"></p> <p><img src="/assets/img/browser11.91ea1cac.png" alt="browser" title="browser"></p> <div class="custom-block tip"><p class="custom-block-title">补充</p> <ul><li><p>CPU 是多核处理器，GPU 是众核处理器。处理器数目至少在48个以上才能称为众核。</p></li> <li><p><a href="https://www.cnblogs.com/biglucky/p/4223565.html" target="_blank" rel="noopener noreferrer">CPU 和 GPU 的区别<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul></div> <h2 id="初窥-webkit"><a href="#初窥-webkit" class="header-anchor">#</a> 初窥 WebKit</h2> <ol><li><p><a href="https://webkit.org/" target="_blank" rel="noopener noreferrer">WebKit 官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="http://www.chromium.org/blink" target="_blank" rel="noopener noreferrer">Blink 官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，Blink 是未来</p></li> <li><p>WebKit 架构图</p></li></ol> <p><img src="/assets/img/browser12.c1204b7e.png" alt="browser" title="browser"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/http/http2.html" class="prev">
        HTTPS、HTTP2、HTTP3
      </a></span> <span class="next"><a href="/performance/optimize1.html">
        性能优化基础知识
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.83f3402d.js" defer></script><script src="/assets/js/2.a0a69aa9.js" defer></script><script src="/assets/js/12.a66aca6c.js" defer></script>
  </body>
</html>
